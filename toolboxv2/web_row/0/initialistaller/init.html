<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Setup</title>
    <link rel="stylesheet" href="../../assets/styles.css">
    <link rel="stylesheet" href="/web/assets/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
        }

        .container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
            max-height: 860px;
            overflow-y: scroll;
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .container.none {
            animation: fadeOut 0.5s ease forwards;
            opacity: 1;
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.9);
            }
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .options button {
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .options button:hover {
            border: var(--primary-color) 1px solid;
        }

        #backArrow {
            position: absolute;
            top: 1%;
            left: 30px;
            cursor: pointer;
            scale: 2.4;
        }

        .terminal-container {
            background-color: rgba(0, 0, 0, 0.8); /* Transparent black background */
            color: #ffffff; /* White text */
            width: 400px;
            height: 300px;
            padding: 10px;
            overflow-y: auto; /* Enable vertical scrollbar */
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); /* White shadow */
        }

        .terminal-line {
            margin: 0;
            padding: 0;
            line-height: 1.1;
            text-align: left;
            background-color: transparent;
            color: white;
        }

        .terminal-line pre {
            background-color: transparent;
            margin: 0;
            padding: 0;
            display: inline;
        }
    </style>
</head>
<body>

<div id="backArrow">&larr;</div>

<div class="container" id="setupContent0">
    <h1 id="setupContent0Titel">Choose your role to set up the system</h1>
    <div class="options">
        <button id="user">User</button>
        <button id="admin">Admin</button>
        <button id="dev">Dev</button>
    </div>
</div>

<div class="container none" id="setupContent1">
    <h1 id="setupContent1Titel">Installation</h1>
    <div class="options">
        <button id="default">Default</button>
        <button id="custom">Custom / Expert</button>
        <!-- <button id="automatic">Automatic via Link-Data</button> -->
    </div>
</div>

<div class="container none" id="setupContent2">
    <h1>Terms and Conditions</h1>
    <p>Please read and agree to the terms and conditions.</p>
    <a href="https://google.com" target="_blank">terms</a>
    <label>
        <input type="checkbox" id="agb">
        I agree to the terms and conditions
    </label>
    <br>
    <button id="agbAccept">Accept</button>
</div>

<div class="container none" id="setupContent3">
    <h1 id="setupContent3Title">Installation</h1>
    <div class="terminal-container" id="terminal">
        <!-- Terminal content goes here -->
    </div>
    <div class="progress-bar-container">
        <div class="progress-bar"></div>
    </div>
</div>

<div class="container none" id="setupContent4">
    <h1>Custom / Expert Setup</h1>
    <!-- Custom / Expert setup options go here -->
    <form id="customSetupForm">
        <label for="installationFolder">installationFolder:</label>
        <input type="text" id="installationFolder" name="installationFolder" value="" placeholder="same as widgets">

        <label for="addRootUser">Add Root User:</label>
        <input type="checkbox" id="addRootUser" name="addRootUser" value="true">

        <label for="stoFolder">Storage Folder:</label>
        <input type="text" id="stoFolder" name="stoFolder" value="./.data" placeholder="Storage Folder">

        <h2>Default Mods:</h2>
        <div id="defaultModsSection"> </div>
        <!-- Default Mods checkboxes will be dynamically generated here -->

        <label for="startBgRunnerSetup">Start Background Runner Setup after installation ?:</label>
        <input type="checkbox" id="startBgRunnerSetup" name="startBgRunnerSetup" value="true">

        <h2>Database Setup:</h2>
        <label for="addDB">Add Database:</label>
        <input type="checkbox" id="addDB" name="addDB" value="true">

        <label for="DBtype">Database Type:</label>
        <select id="DBtype" name="DBtype">
            <option value="local">Local</option>
            <option value="local">Redis</option>
            <option value="local">Remote-Redis</option>
            <!-- Add more database types if needed -->
        </select>

        <label for="DBUri">Database URI:</label>
        <input type="text" id="DBUri" name="DBUri" value="" placeholder="Database URI">

        <label for="DBUserName">Database User Name:</label>
        <input type="text" id="DBUserName" name="DBUserName" value="" placeholder="Database User Name">

        <label for="DBKey">Database Key:</label>
        <input type="text" id="DBKey" name="DBKey" value="" placeholder="Database Key">

    </form>
    <button id="CustomDataSubmit">Submit</button>
</div>


<div class="container none" id="setupContent5">
    <h1>How did u get hir ?</h1>
</div>

<div class="container none" id="setupContent6">
    <h1>Summary</h1>
    <!-- Summary of entered data goes here -->
    <div id="SummarySection"></div>
    <button id="summarySubmit1">Start Installation</button>
    <button id="summarySubmit2">Edit Configs</button>
</div>

<div class="container none" id="setupContent7">
    <h1 id="setupContent7Title">Installation Successful</h1>
    <!-- Success message goes here -->

</div>

<script>

    const MaxContent = 8
    let AcContent = 0
    let as = -1
    let dos = -1

    let stack = [0]

    let installation_data = {
        'installationFolder': './',
        'addRootUser': false,
        'stoFolder': './.data',
        'addDB': false,
        'DBtype': 'local',
        'DBUri': null,
        'DBUserName': null,
        'DBKey': null,
        'startBgRunnerSetup': false,
        'DefaultMods': ['DB', 'CloudM', 'welcome', 'EventManager', 'WidgetsProvider', 'api_manager',
            'cicd', 'cli_functions', 'SchedulerManager', 'SocketManager'],
        'connectTO': {
            'remote': false,
            'localP0': false,
        },
        'autoStart': false,
        "MODS": 'additional',
        'Install': ['DB', 'CloudM', 'welcome', 'EventManager', 'WidgetsProvider', 'api_manager',
            'cicd', 'cli_functions', 'SchedulerManager', 'SocketManager'],
    }
    function showContent(i){
        if (i===MaxContent){
            return
        }
        stack.push(i)
        AcContent = i
        for (let j = 0; j < MaxContent; j++) {
            let Content = document.getElementById('setupContent'+j)
            if (j===i){
                Content.classList.remove('none')
            }else{
                Content.classList.add('none')
            }
        }

        if (i===3){
            // start istalation
        }
        if (i===4){
            populateConfig()
        }
        if (i===6){
            displaySummary()
        }
        if (i===7){

            if (installation_data['addRootUser']){
                // run command
            }
            if (installation_data['startBgRunnerSetup']){
                // run command
            }
            if (installation_data['addDB']){
                // run command
            }
            if (installation_data['autoStart']){
                // run command
            }
            if (installation_data['connectTO']['remote']){
                // run command
            }
            if (installation_data['connectTO']['localP0']){
                // run command
            }
        }
    }

    // Function to go back to the previous step
    function backToPrevious() {

        if (stack.length !== 1){
            let z = stack.pop()
            let e = stack.pop()
            console.log(stack, e, z)
            showContent(e)
        }else{
            document.getElementById('setupContent0Titel').innerText = "i thing User is best for u :)";
        }
    }

    // Add event listener to back arrow
    document.getElementById('backArrow').addEventListener('click', function() {
        backToPrevious();
    });

    // Add event listeners to the buttons
    document.getElementById('user').addEventListener('click', function() {
        flipContainer("User");
        as = 0
        installation_data = { ...installation_data, ...{
            'addDB': true,
            'DBtype': 'local',
            'connectTO': {
                'remote': true,
                'localP0': false,
            },

            'Install': [
                'DB',
                'CloudM',
                'welcome',
                'EventManager',
                'WidgetsProvider',
                'api_manager',
                'cli_functions',
                'SchedulerManager',
                'SocketManager'],
        } };
    });

    document.getElementById('admin').addEventListener('click', function() {
        flipContainer("Admin");
        as = 1
        installation_data = { ...installation_data, ...{
            'addRootUser': true,
            'addDB': true,
            'startBgRunnerSetup': true,
            'connectTO': {
                'remote': true,
                'localP0': true,
            },
            'autoStart': true,
            'Install': [
                'DB',
                'CloudM',
                'welcome',
                'EventManager',
                'WidgetsProvider',
                'api_manager',
                'cli_functions',
                'SchedulerManager',
                'SocketManager'],
        }
        };
    });

    document.getElementById('dev').addEventListener('click', function() {
        flipContainer("Dev");
        as = 2
        installation_data = { ...installation_data, ...{

                'addRootUser': true,
                'addDB': true,

                'startBgRunnerSetup': true,

                'connectTO': {
                    'remote': true,
                    'localP0': true,
                },
                'autoStart': true,

                'Install': [
                    'DB',
                    'CloudM',
                    'welcome',
                    'EventManager',
                    'WidgetsProvider',
                    'api_manager',
                    'cicd',
                    'cli_functions',
                    'SchedulerManager',
                    'SocketManager'],
            }
        };
    });

    function flipContainer(titel) {
        showContent(1)
        document.getElementById('setupContent1Titel').innerText = titel + " Installation";
    }

    // Add event listeners to the setup options
    document.getElementById('default').addEventListener('click', function() {
        // Perform action for Default Setup
        console.log('Default setup selected');
        dos = 1
        showContent(AcContent+1)
    });

    document.getElementById('custom').addEventListener('click', function() {
        // Perform action for Custom / Expert Setup
        console.log('Custom / Expert setup selected');
        dos = 2
        showContent(AcContent+1)
    });


    document.getElementById('agbAccept').addEventListener('click', function() {
        // Check if the checkbox is checked
        const agbCheckbox = document.getElementById('agb');
        console.log(agbCheckbox.checked, AcContent, dos)
        if (agbCheckbox.checked) {
            // Perform action for Automatic Setup via Link-Data
            console.log('Terms accepted');
            showContent(AcContent+dos);
        } else {
            // If checkbox is not checked, change the background color to light red
            const agbContainer = document.getElementById('setupContent2');
            agbContainer.style.backgroundColor = '#ffcccc';
        }
    });

    function populateConfig(){

// Populate Default Mods checkboxes
        const defaultModsSection = document.getElementById('defaultModsSection');
        installation_data.DefaultMods.forEach(mod => {
            const outer = document.createElement('div');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.name = 'defaultMods';
            checkbox.value = mod;
            checkbox.checked = installation_data.Install.includes(mod); // Initially checked
            checkbox.title = 'Tooltip text'; // Add tooltip
            const label = document.createElement('label');
            const he = document.createElement('hr');
            label.textContent = mod;
            outer.appendChild(checkbox);
            outer.appendChild(label);
            outer.appendChild(he);
            defaultModsSection.appendChild(outer);
        });
    }

    document.getElementById('CustomDataSubmit').addEventListener('click', function() {
        // Get form data
        const form = document.getElementById('customSetupForm');
        const formData = new FormData(form);

        // Convert formData to object
        const customData = {};
        for (const [key, value] of formData.entries()) {
            customData[key] = value;
        }

        // Merge custom data with installation data
        installation_data = { ...installation_data, ...customData };

        // Perform any further actions (for demo purpose, log merged data)
        console.log('Merged Data:', installation_data);
        showContent(6)
        // Navigate to the Summary section
    });

    function displaySummary() {
        const summaryContainer = document.getElementById('SummarySection');
        summaryContainer.innerHTML = ''; // Clear previous content

        const summaryList = document.createElement('ul');

        // Iterate through installation_data object
        for (const key in installation_data) {
            if (installation_data.hasOwnProperty(key) && key !== 'DefaultMods' && key !== 'connectTO' && key !== 'Install') {
                const value = installation_data[key];
                addSummaryItem(summaryList, key, value);
            }
            if (key === 'Install') {
                const summaryList1 = document.createElement('ul');
                const value = installation_data['Install'];
                for (const valueKey in value) {
                    addSummaryItem(summaryList1, installation_data['Install'][valueKey], '+');
                }
                summaryList.appendChild(summaryList1)
            }
        }

        summaryContainer.appendChild(summaryList);
    }

    function addSummaryItem(container, label, value) {
        const item = document.createElement('li');
        item.innerHTML = `<strong>${label}:</strong> ${value}`;
        container.appendChild(item);
    }

    document.getElementById('summarySubmit1').addEventListener('click', function() {
        // Perform action for Automatic Setup via Link-Data
        console.log('summarySubmit start install');
        showContent(3)
    });

    document.getElementById('summarySubmit2').addEventListener('click', function() {
        // Perform action for Automatic Setup via Link-Data
        console.log('summarySubmit start install');
        showContent(4)
    });

    function addLine(line) {
        var terminal = document.getElementById('terminal');
        var newLine = document.createElement('div');
        newLine.className = 'terminal-line';
        newLine.innerHTML = '<pre>' + line + '</pre>';
        terminal.appendChild(newLine);
        // Highlight.js to colorize the code
        hljs.highlightBlock(newLine);
        // Scroll to bottom
        terminal.scrollTop = terminal.scrollHeight;
    }
</script>

</body>
</html>
