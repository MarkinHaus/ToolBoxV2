<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToolBox Pro</title>
    <link rel="stylesheet" href="popup.css">
    <style>
        /* Fallback styles in case CSS doesn't load */
        body {
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
        }
        .app-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .app-header {
            padding: 16px;
            background: rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .logo {
            width: 24px;
            height: 24px;
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <!-- Header with Voice Input -->
        <!-- Tab Navigation -->
        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="isaa">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>ISAA Chat</span>
            </button>
            <button class="tab-btn" data-tab="search">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <span>Live Search</span>
            </button>
            <button class="tab-btn" data-tab="passwords">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <circle cx="12" cy="16" r="1"></circle>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <span>Passwords</span>
            </button>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- ISAA Chat Panel -->

            <div id="isaaPanelContent" class="panel-content active">
                <div class="chat-container">
                    <div id="chatMessages" class="chat-messages">
                        <div class="welcome-message">
                            <div class="isaa-avatar">ðŸ¤–</div>
                            <div class="message-content">
                                <p>Hello! I'm ISAA, your AI assistant. I can help you:</p>
                                <ul>
                                    <li>Navigate and interact with web pages</li>
                                    <li>Download files and export data</li>
                                    <li>Answer questions about page content</li>
                                    <li>Automate web tasks</li>
                                </ul>
                                <p>How can I assist you today?</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chatInput" placeholder="Ask ISAA anything..." class="chat-input">
                        <button id="chatSend" class="chat-send-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22,2 15,22 11,13 2,9"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Live Search Panel -->
            <div id="searchPanelContent" class="panel-content">
                <div class="search-container">

                    <div id="searchResults" class="search-results">
                        <div class="no-results">
                            <p>Start typing to search the current page...</p>
                        </div>
                    </div>
                    <div class="search-header">
                        <input type="text" id="liveSearchInput" placeholder="Search current page..." class="live-search-input">
                        <div class="search-options">
                            <button id="indexPageBtn" class="option-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                </svg>
                                Index Page
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Password Manager Panel -->
            <div id="passwordsPanelContent" class="panel-content">
                <div class="password-container">
                    <div id="passwordList" class="password-list">
                        <div class="loading-passwords">
                            <div class="spinner"></div>
                            <p>Loading passwords...</p>
                        </div>
                    </div>
                    <div class="password-header">
                        <div class="password-actions">
                            <button id="autofillBtn" class="action-btn primary">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 12l2 2 4-4"></path>
                                    <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                    <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                </svg>
                                Auto-fill
                            </button>
                            <button id="generateBtn" class="action-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                </svg>
                                Generate
                            </button>
                             <button id="addPasswordBtn" class="action-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                HinzufÃ¼gen
                            </button>
                            <button id="importBtn" class="action-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                </svg>
                                Import
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="voice-section" style="display: flex; align-items: center;">
                 <div class="settings-toggle" title="Open Settings">
                  <button id="openSettingsBtn" class="settings-button">
                  <svg width="64px" height="64px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <circle cx="12" cy="12" r="3" stroke="#ffffff" stroke-width="1.5"></circle> <path d="M3.66122 10.6392C4.13377 10.9361 4.43782 11.4419 4.43782 11.9999C4.43781 12.558 4.13376 13.0638 3.66122 13.3607C3.33966 13.5627 3.13248 13.7242 2.98508 13.9163C2.66217 14.3372 2.51966 14.869 2.5889 15.3949C2.64082 15.7893 2.87379 16.1928 3.33973 16.9999C3.80568 17.8069 4.03865 18.2104 4.35426 18.4526C4.77508 18.7755 5.30694 18.918 5.83284 18.8488C6.07287 18.8172 6.31628 18.7185 6.65196 18.5411C7.14544 18.2803 7.73558 18.2699 8.21895 18.549C8.70227 18.8281 8.98827 19.3443 9.00912 19.902C9.02332 20.2815 9.05958 20.5417 9.15224 20.7654C9.35523 21.2554 9.74458 21.6448 10.2346 21.8478C10.6022 22 11.0681 22 12 22C12.9319 22 13.3978 22 13.7654 21.8478C14.2554 21.6448 14.6448 21.2554 14.8478 20.7654C14.9404 20.5417 14.9767 20.2815 14.9909 19.9021C15.0117 19.3443 15.2977 18.8281 15.7811 18.549C16.2644 18.27 16.8545 18.2804 17.3479 18.5412C17.6837 18.7186 17.9271 18.8173 18.1671 18.8489C18.693 18.9182 19.2249 18.7756 19.6457 18.4527C19.9613 18.2106 20.1943 17.807 20.6603 17C20.8677 16.6407 21.029 16.3614 21.1486 16.1272M20.3387 13.3608C19.8662 13.0639 19.5622 12.5581 19.5621 12.0001C19.5621 11.442 19.8662 10.9361 20.3387 10.6392C20.6603 10.4372 20.8674 10.2757 21.0148 10.0836C21.3377 9.66278 21.4802 9.13092 21.411 8.60502C21.3591 8.2106 21.1261 7.80708 20.6601 7.00005C20.1942 6.19301 19.9612 5.7895 19.6456 5.54732C19.2248 5.22441 18.6929 5.0819 18.167 5.15113C17.927 5.18274 17.6836 5.2814 17.3479 5.45883C16.8544 5.71964 16.2643 5.73004 15.781 5.45096C15.2977 5.1719 15.0117 4.6557 14.9909 4.09803C14.9767 3.71852 14.9404 3.45835 14.8478 3.23463C14.6448 2.74458 14.2554 2.35523 13.7654 2.15224C13.3978 2 12.9319 2 12 2C11.0681 2 10.6022 2 10.2346 2.15224C9.74458 2.35523 9.35523 2.74458 9.15224 3.23463C9.05958 3.45833 9.02332 3.71848 9.00912 4.09794C8.98826 4.65566 8.70225 5.17191 8.21891 5.45096C7.73557 5.73002 7.14548 5.71959 6.65205 5.4588C6.31633 5.28136 6.0729 5.18269 5.83285 5.15108C5.30695 5.08185 4.77509 5.22436 4.35427 5.54727C4.03866 5.78945 3.80569 6.19297 3.33974 7C3.13231 7.35929 2.97105 7.63859 2.85138 7.87273" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> </g></svg>
                  </button>
                </div>
                <div class="agent-mode-toggle" title="Toggle Agent Mode">
                    <input type="checkbox" id="agentModeSwitch" class="toggle-checkbox">
                    <label for="agentModeSwitch" class="toggle-label">
                        <span class="toggle-text">Agent</span>
                    </label>
                </div>
                <select id="languageSelect" class="language-select" title="Voice Language">
                    <option value="en-US">ðŸ‡ºðŸ‡¸ EN</option>
                    <option value="de-DE">ðŸ‡©ðŸ‡ª DE</option>
                    <option value="fr-FR">ðŸ‡«ðŸ‡· FR</option>
                    <option value="es-ES">ðŸ‡ªðŸ‡¸ ES</option>
                </select>
                <button id="voiceBtn" class="voice-btn" title="Voice Input (Ctrl+Shift+V)">
                    <div class="voice-status-dot ready"></div>
                    <svg class="mic-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
            </div>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="connection-status">
                <div id="connectionIndicator" class="status-indicator connecting">
                    <div class="status-dot"></div>
                    <span id="connectionText">Connecting...</span>
                </div>
            </div>
            <div class="page-info">
                <span id="pageTitle">Loading...</span>
            </div>
        </footer>
    </div>

    <!-- Modals and Overlays -->
    <div id="totpModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>2FA Code</h3>
                <button class="modal-close">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="totp-display">
                    <div class="totp-code" id="totpCode">000000</div>
                    <div class="totp-timer">
                        <div class="timer-circle">
                            <div class="timer-fill" id="totpTimer"></div>
                        </div>
                        <span id="totpTimeLeft">30</span>
                    </div>
                </div>
                <p class="totp-account" id="totpAccount">Account</p>
                <button id="copyTotpBtn" class="copy-btn">Copy Code</button>
            </div>
        </div>
    </div>

     <div id="importHelperModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>PasswÃ¶rter importieren</h3>
                <button class="modal-close">Ã—</button>
            </div>
            <div class="modal-body">
                <p>ToolBox Pro kann aus SicherheitsgrÃ¼nden nicht direkt auf Ihre Browser-PasswÃ¶rter zugreifen. Bitte exportieren Sie sie zuerst:</p>
                <div class="import-guide">
                    <h4>Anleitung fÃ¼r Chrome</h4>
                    <ol>
                        <li>Ã–ffnen Sie die Chrome-Einstellungen oder geben Sie <strong>chrome://settings/passwords</strong> in die Adressleiste ein.</li>
                        <li>Klicken Sie auf das Drei-Punkte-MenÃ¼ (â‹®) neben "Gespeicherte PasswÃ¶rter".</li>
                        <li>WÃ¤hlen Sie <strong>"PasswÃ¶rter exportieren..."</strong> und speichern Sie die <code>.csv</code>-Datei.</li>
                        <li>SchlieÃŸen Sie dieses Fenster und klicken Sie unten auf "Datei auswÃ¤hlen", um die exportierte Datei hochzuladen.</li>
                    </ol>
                </div>
                 <button id="openImportDialogBtn" class="action-btn primary">Datei auswÃ¤hlen</button>
            </div>
        </div>
    </div>

    <div id="addPasswordModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Neues Passwort hinzufÃ¼gen</h3>
                <button class="modal-close">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="addPasswordForm" class="password-form">
                    <input type="text" id="add-title" placeholder="Titel (z.B. Google)" required>
                    <input type="url" id="add-url" placeholder="URL (https://...)" required>
                    <input type="text" id="add-username" placeholder="Benutzername" required>
                    <input type="password" id="add-password" placeholder="Passwort" required>

                     <div id="addPasswordFeedback" class="form-feedback"></div>
                    <button type="submit" class="action-btn primary">Speichern</button>
                </form>
            </div>
        </div>
    </div>

    <div id="addTotpModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>2FA fÃ¼r <span id="totp-modal-title"></span> hinzufÃ¼gen</h3>
                <button class="modal-close">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="addTotpForm" class="password-form">
                    <p>Geben Sie den geheimen SchlÃ¼ssel (Secret Key) ein, den Sie von der Webseite erhalten haben.</p>
                    <input type="hidden" id="totp-entry-id">
                    <input type="text" id="totp-secret-input" placeholder="Geheimer SchlÃ¼ssel" required>
                    <div id="addTotpFeedback" class="form-feedback"></div>
                    <button type="submit" id="addTotpSubmitBtn" class="action-btn primary">2FA Aktivieren</button>
                </form>
            </div>
        </div>
    </div>

    <div id="confirmationModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmationTitle">BestÃ¤tigung erforderlich</h3>
                <button class="modal-close">Ã—</button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Sind Sie sicher?</p>
                <div class="confirmation-actions">
                    <button id="confirmBtn-cancel" class="action-btn">Abbrechen</button>
                    <button id="confirmBtn-confirm" class="action-btn btn-danger">BestÃ¤tigen</button>
                </div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ToolBox Pro Settings</h3>
            <button class="modal-close">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="settings-section">
                <h4>Backend Configuration</h4>
                <select id="backendSelector" class="settings-select">
                    <option value="local">Local (localhost:8080)</option>
                    <option value="remote">Remote (simplecore.app)</option>
                    <option value="custom">Custom URL...</option>
                </select>
                <input type="text" id="customBackendUrl" class="settings-input hidden"
                       placeholder="https://your-backend.com">
            </div>

            <div class="settings-section">
                <h4>Authentication</h4>
                <div id="authStatus" class="auth-status">
                    <span class="status-dot"></span>
                    <span id="authStatusText">Not authenticated</span>
                </div>

                <div id="loginForm" class="login-form">
                    <input type="text" id="settings-username" placeholder="Username" class="settings-input">
                    <input type="password" id="settings-jwt" placeholder="JWT Token (optional)" class="settings-input">
                    <button id="loginBtn" class="action-btn primary">Login</button>

                    <div class="divider">OR</div>

                    <input type="text" id="magicLinkKey" placeholder="Magic Link Key" class="settings-input">
                    <button id="magicLinkBtn" class="action-btn">Use Magic Link</button>
                </div>

                <div id="loggedInInfo" class="hidden">
                    <p>Logged in as: <strong id="currentUsername"></strong></p>
                    <button id="logoutBtn" class="action-btn">Logout</button>
                </div>
            </div>

            <div id="settingsFeedback" class="form-feedback"></div>
        </div>
    </div>
</div>

    <script src="popup.js"></script>
</body>
</html>
