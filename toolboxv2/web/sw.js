// sw.js - Service Worker
// This file should be at the root of your deployment or accessible via the scope defined.

const CACHE_NAME = "tbjs-app-cache-v1.2"; // Increment version to force update
const OFFLINE_URL = "/web/assets/offline.html"; // A simple offline fallback page (you need to create this)
const LOG_PREFIX = "[SW]";

// Log helper for Service Worker context
function swLog(message, ...args) {
    console.log(`${LOG_PREFIX} ${message}`, ...args);
}
function swError(message, ...args) {
    console.error(`${LOG_PREFIX} ${message}`, ...args);
}
function swWarn(message, ...args) {
    console.warn(`${LOG_PREFIX} ${message}`, ...args);
}


// List of assets to cache on install
// Ensure paths are absolute from the origin (e.g., /web/styles/main.css)
// This list is illustrative; the original list was very long.
// Consider generating this list during your build process.
const CORE_ASSETS_TO_CACHE = [
    OFFLINE_URL, // Make sure your offline fallback page is cached
    "/tbjs.css", // Assuming your bundled CSS for tbjs is here
    "/web/assets/styles.css", // Example common styles
    "/web/assets/404.html",
    "/web/assets/401.html",
    "/web/assets/login.html",
    "/web/assets/signup.html",
    "/web/assets/logout.html",
    // Add other critical shell assets: favicons, manifest.json, key JS bundles
    // e.g., '/dist/main.js', '/manifest.json', '/favicon.ico'
];

// From original sw.js, paths need to be root-relative
const APP_SPECIFIC_ASSETS = [
    // "/web/sw.js", // SW itself is not cached by itself this way
    "/web/3Dbg.html",
    "/web/scripts/scripts.js", // If these are still used and not part of tbjs bundle
    "/web/scripts/WorkerSocketRenderer.js", // if still used
    "/web/assets/serverInWartung.html",
    "/web/assets/terms.html",
    "/web/webapp/manifest.json",
    "/web/webapp/icon-192.png",
    "/web/webapp/icon-512.png",
"/web/3Dbg.html",
"/web/scripts/scripts.js",
"/web/scripts/WorkerSocketRenderer.js",
"/web/assets/serverInWartung.html",
"/web/assets/terms.html",
"/web/assets/404.html",
"/web/assets/401.html",
"/web/assets/styles.css?v=1.0",
"/web/webapp/manifest.json",
"/web/webapp/icon-192.png",
"/web/webapp/icon-512.png",
"/web/webapp/styles.css?v=1.0",
"/web/Drag/drag.css",
"/web/Drag/drag.html",
"/web/Drag/drag.js",
"/web/systemMSG/speech_balloon.css",
"/web/systemMSG/speech_balloon.js",
"/web/systemMSG/text.html",
'/web/node_modules/.package-lock.json', '/web/node_modules/three/package.json', '/web/node_modules/three/build/three.js', '/web/node_modules/three/build/three.min.js', '/web/node_modules/three/build/three.module.js', '/web/node_modules/three/build/three.module.min.js', '/web/node_modules/three/examples/fonts/gentilis_bold.typeface.json', '/web/node_modules/three/examples/fonts/gentilis_regular.typeface.json', '/web/node_modules/three/examples/fonts/helvetiker_bold.typeface.json', '/web/node_modules/three/examples/fonts/helvetiker_regular.typeface.json', '/web/node_modules/three/examples/fonts/optimer_bold.typeface.json', '/web/node_modules/three/examples/fonts/optimer_regular.typeface.json', '/web/node_modules/three/examples/fonts/droid/droid_sans_bold.typeface.json', '/web/node_modules/three/examples/fonts/droid/droid_sans_mono_regular.typeface.json', '/web/node_modules/three/examples/fonts/droid/droid_sans_regular.typeface.json', '/web/node_modules/three/examples/fonts/droid/droid_serif_bold.typeface.json', '/web/node_modules/three/examples/fonts/droid/droid_serif_regular.typeface.json', '/web/node_modules/three/examples/jsm/animation/AnimationClipCreator.js', '/web/node_modules/three/examples/jsm/animation/CCDIKSolver.js', '/web/node_modules/three/examples/jsm/animation/MMDAnimationHelper.js', '/web/node_modules/three/examples/jsm/animation/MMDPhysics.js', '/web/node_modules/three/examples/jsm/cameras/CinematicCamera.js', '/web/node_modules/three/examples/jsm/capabilities/WebGL.js', '/web/node_modules/three/examples/jsm/capabilities/WebGPU.js', '/web/node_modules/three/examples/jsm/controls/ArcballControls.js', '/web/node_modules/three/examples/jsm/controls/DragControls.js', '/web/node_modules/three/examples/jsm/controls/FirstPersonControls.js', '/web/node_modules/three/examples/jsm/controls/FlyControls.js', '/web/node_modules/three/examples/jsm/controls/MapControls.js', '/web/node_modules/three/examples/jsm/controls/OrbitControls.js', '/web/node_modules/three/examples/jsm/controls/PointerLockControls.js', '/web/node_modules/three/examples/jsm/controls/TrackballControls.js', '/web/node_modules/three/examples/jsm/controls/TransformControls.js', '/web/node_modules/three/examples/jsm/csm/CSM.js', '/web/node_modules/three/examples/jsm/csm/CSMFrustum.js', '/web/node_modules/three/examples/jsm/csm/CSMHelper.js', '/web/node_modules/three/examples/jsm/csm/CSMShader.js', '/web/node_modules/three/examples/jsm/curves/CurveExtras.js', '/web/node_modules/three/examples/jsm/curves/NURBSCurve.js', '/web/node_modules/three/examples/jsm/curves/NURBSSurface.js', '/web/node_modules/three/examples/jsm/curves/NURBSUtils.js', '/web/node_modules/three/examples/jsm/effects/AnaglyphEffect.js', '/web/node_modules/three/examples/jsm/effects/AsciiEffect.js', '/web/node_modules/three/examples/jsm/effects/OutlineEffect.js', '/web/node_modules/three/examples/jsm/effects/ParallaxBarrierEffect.js', '/web/node_modules/three/examples/jsm/effects/PeppersGhostEffect.js', '/web/node_modules/three/examples/jsm/effects/StereoEffect.js', '/web/node_modules/three/examples/jsm/environments/DebugEnvironment.js', '/web/node_modules/three/examples/jsm/environments/RoomEnvironment.js', '/web/node_modules/three/examples/jsm/exporters/DRACOExporter.js', '/web/node_modules/three/examples/jsm/exporters/EXRExporter.js', '/web/node_modules/three/examples/jsm/exporters/GLTFExporter.js', '/web/node_modules/three/examples/jsm/exporters/KTX2Exporter.js', '/web/node_modules/three/examples/jsm/exporters/MMDExporter.js', '/web/node_modules/three/examples/jsm/exporters/OBJExporter.js', '/web/node_modules/three/examples/jsm/exporters/PLYExporter.js', '/web/node_modules/three/examples/jsm/exporters/STLExporter.js', '/web/node_modules/three/examples/jsm/exporters/USDZExporter.js', '/web/node_modules/three/examples/jsm/geometries/BoxLineGeometry.js', '/web/node_modules/three/examples/jsm/geometries/ConvexGeometry.js', '/web/node_modules/three/examples/jsm/geometries/DecalGeometry.js', '/web/node_modules/three/examples/jsm/geometries/ParametricGeometries.js', '/web/node_modules/three/examples/jsm/geometries/ParametricGeometry.js', '/web/node_modules/three/examples/jsm/geometries/RoundedBoxGeometry.js', '/web/node_modules/three/examples/jsm/geometries/TeapotGeometry.js', '/web/node_modules/three/examples/jsm/geometries/TextGeometry.js', '/web/node_modules/three/examples/jsm/helpers/LightProbeHelper.js', '/web/node_modules/three/examples/jsm/helpers/OctreeHelper.js', '/web/node_modules/three/examples/jsm/helpers/PositionalAudioHelper.js', '/web/node_modules/three/examples/jsm/helpers/RectAreaLightHelper.js', '/web/node_modules/three/examples/jsm/helpers/VertexNormalsHelper.js', '/web/node_modules/three/examples/jsm/helpers/VertexTangentsHelper.js', '/web/node_modules/three/examples/jsm/helpers/ViewHelper.js', '/web/node_modules/three/examples/jsm/interactive/HTMLMesh.js', '/web/node_modules/three/examples/jsm/interactive/InteractiveGroup.js', '/web/node_modules/three/examples/jsm/interactive/SelectionBox.js', '/web/node_modules/three/examples/jsm/interactive/SelectionHelper.js', '/web/node_modules/three/examples/jsm/libs/ammo.wasm.js', '/web/node_modules/three/examples/jsm/libs/chevrotain.module.min.js', '/web/node_modules/three/examples/jsm/libs/ecsy.module.js', '/web/node_modules/three/examples/jsm/libs/fflate.module.js', '/web/node_modules/three/examples/jsm/libs/ktx-parse.module.js', '/web/node_modules/three/examples/jsm/libs/lil-gui.module.min.js', '/web/node_modules/three/examples/jsm/libs/lottie_canvas.module.js', '/web/node_modules/three/examples/jsm/libs/meshopt_decoder.module.js', '/web/node_modules/three/examples/jsm/libs/mikktspace.module.js', '/web/node_modules/three/examples/jsm/libs/mmdparser.module.js', '/web/node_modules/three/examples/jsm/libs/motion-controllers.module.js', '/web/node_modules/three/examples/jsm/libs/opentype.module.js', '/web/node_modules/three/examples/jsm/libs/potpack.module.js', '/web/node_modules/three/examples/jsm/libs/stats.module.js', '/web/node_modules/three/examples/jsm/libs/tween.module.js', '/web/node_modules/three/examples/jsm/libs/utif.module.js', '/web/node_modules/three/examples/jsm/libs/zstddec.module.js', '/web/node_modules/three/examples/jsm/libs/basis/basis_transcoder.js', '/web/node_modules/three/examples/jsm/libs/draco/draco_decoder.js', '/web/node_modules/three/examples/jsm/libs/draco/draco_encoder.js', '/web/node_modules/three/examples/jsm/libs/draco/draco_wasm_wrapper.js', '/web/node_modules/three/examples/jsm/libs/draco/gltf/draco_decoder.js', '/web/node_modules/three/examples/jsm/libs/draco/gltf/draco_encoder.js', '/web/node_modules/three/examples/jsm/libs/draco/gltf/draco_wasm_wrapper.js', '/web/node_modules/three/examples/jsm/libs/rhino3dm/rhino3dm.js', '/web/node_modules/three/examples/jsm/libs/rhino3dm/rhino3dm.module.js', '/web/node_modules/three/examples/jsm/lights/IESSpotLight.js', '/web/node_modules/three/examples/jsm/lights/LightProbeGenerator.js', '/web/node_modules/three/examples/jsm/lights/RectAreaLightUniformsLib.js', '/web/node_modules/three/examples/jsm/lines/Line2.js', '/web/node_modules/three/examples/jsm/lines/LineGeometry.js', '/web/node_modules/three/examples/jsm/lines/LineMaterial.js', '/web/node_modules/three/examples/jsm/lines/LineSegments2.js', '/web/node_modules/three/examples/jsm/lines/LineSegmentsGeometry.js', '/web/node_modules/three/examples/jsm/lines/Wireframe.js', '/web/node_modules/three/examples/jsm/lines/WireframeGeometry2.js', '/web/node_modules/three/examples/jsm/loaders/3DMLoader.js', '/web/node_modules/three/examples/jsm/loaders/3MFLoader.js', '/web/node_modules/three/examples/jsm/loaders/AMFLoader.js', '/web/node_modules/three/examples/jsm/loaders/BVHLoader.js', '/web/node_modules/three/examples/jsm/loaders/ColladaLoader.js', '/web/node_modules/three/examples/jsm/loaders/DDSLoader.js', '/web/node_modules/three/examples/jsm/loaders/DRACOLoader.js', '/web/node_modules/three/examples/jsm/loaders/EXRLoader.js', '/web/node_modules/three/examples/jsm/loaders/FBXLoader.js', '/web/node_modules/three/examples/jsm/loaders/FontLoader.js', '/web/node_modules/three/examples/jsm/loaders/GCodeLoader.js', '/web/node_modules/three/examples/jsm/loaders/GLTFLoader.js', '/web/node_modules/three/examples/jsm/loaders/HDRCubeTextureLoader.js', '/web/node_modules/three/examples/jsm/loaders/IESLoader.js', '/web/node_modules/three/examples/jsm/loaders/KMZLoader.js', '/web/node_modules/three/examples/jsm/loaders/KTX2Loader.js', '/web/node_modules/three/examples/jsm/loaders/KTXLoader.js', '/web/node_modules/three/examples/jsm/loaders/LDrawLoader.js', '/web/node_modules/three/examples/jsm/loaders/LogLuvLoader.js', '/web/node_modules/three/examples/jsm/loaders/LottieLoader.js', '/web/node_modules/three/examples/jsm/loaders/LUT3dlLoader.js', '/web/node_modules/three/examples/jsm/loaders/LUTCubeLoader.js', '/web/node_modules/three/examples/jsm/loaders/LWOLoader.js', '/web/node_modules/three/examples/jsm/loaders/MaterialXLoader.js', '/web/node_modules/three/examples/jsm/loaders/MD2Loader.js', '/web/node_modules/three/examples/jsm/loaders/MDDLoader.js', '/web/node_modules/three/examples/jsm/loaders/MMDLoader.js', '/web/node_modules/three/examples/jsm/loaders/MTLLoader.js', '/web/node_modules/three/examples/jsm/loaders/NRRDLoader.js', '/web/node_modules/three/examples/jsm/loaders/OBJLoader.js', '/web/node_modules/three/examples/jsm/loaders/PCDLoader.js', '/web/node_modules/three/examples/jsm/loaders/PDBLoader.js', '/web/node_modules/three/examples/jsm/loaders/PLYLoader.js', '/web/node_modules/three/examples/jsm/loaders/PVRLoader.js', '/web/node_modules/three/examples/jsm/loaders/RGBELoader.js', '/web/node_modules/three/examples/jsm/loaders/RGBMLoader.js', '/web/node_modules/three/examples/jsm/loaders/STLLoader.js', '/web/node_modules/three/examples/jsm/loaders/SVGLoader.js', '/web/node_modules/three/examples/jsm/loaders/TDSLoader.js', '/web/node_modules/three/examples/jsm/loaders/TGALoader.js', '/web/node_modules/three/examples/jsm/loaders/TIFFLoader.js', '/web/node_modules/three/examples/jsm/loaders/TiltLoader.js', '/web/node_modules/three/examples/jsm/loaders/TTFLoader.js', '/web/node_modules/three/examples/jsm/loaders/USDZLoader.js', '/web/node_modules/three/examples/jsm/loaders/VOXLoader.js', '/web/node_modules/three/examples/jsm/loaders/VRMLLoader.js', '/web/node_modules/three/examples/jsm/loaders/VTKLoader.js', '/web/node_modules/three/examples/jsm/loaders/XYZLoader.js', '/web/node_modules/three/examples/jsm/loaders/lwo/IFFParser.js', '/web/node_modules/three/examples/jsm/loaders/lwo/LWO2Parser.js', '/web/node_modules/three/examples/jsm/loaders/lwo/LWO3Parser.js', '/web/node_modules/three/examples/jsm/materials/MeshGouraudMaterial.js', '/web/node_modules/three/examples/jsm/math/Capsule.js', '/web/node_modules/three/examples/jsm/math/ColorConverter.js', '/web/node_modules/three/examples/jsm/math/ConvexHull.js', '/web/node_modules/three/examples/jsm/math/ImprovedNoise.js', '/web/node_modules/three/examples/jsm/math/Lut.js', '/web/node_modules/three/examples/jsm/math/MeshSurfaceSampler.js', '/web/node_modules/three/examples/jsm/math/OBB.js', '/web/node_modules/three/examples/jsm/math/Octree.js', '/web/node_modules/three/examples/jsm/math/SimplexNoise.js', '/web/node_modules/three/examples/jsm/misc/ConvexObjectBreaker.js', '/web/node_modules/three/examples/jsm/misc/GPUComputationRenderer.js', '/web/node_modules/three/examples/jsm/misc/Gyroscope.js', '/web/node_modules/three/examples/jsm/misc/MD2Character.js', '/web/node_modules/three/examples/jsm/misc/MD2CharacterComplex.js', '/web/node_modules/three/examples/jsm/misc/MorphAnimMesh.js', '/web/node_modules/three/examples/jsm/misc/MorphBlendMesh.js', '/web/node_modules/three/examples/jsm/misc/ProgressiveLightMap.js', '/web/node_modules/three/examples/jsm/misc/RollerCoaster.js', '/web/node_modules/three/examples/jsm/misc/TubePainter.js', '/web/node_modules/three/examples/jsm/misc/Volume.js', '/web/node_modules/three/examples/jsm/misc/VolumeSlice.js', '/web/node_modules/three/examples/jsm/modifiers/CurveModifier.js', '/web/node_modules/three/examples/jsm/modifiers/EdgeSplitModifier.js', '/web/node_modules/three/examples/jsm/modifiers/SimplifyModifier.js', '/web/node_modules/three/examples/jsm/modifiers/TessellateModifier.js', '/web/node_modules/three/examples/jsm/nodes/Nodes.js', '/web/node_modules/three/examples/jsm/nodes/accessors/BitangentNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/BufferAttributeNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/BufferNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/CameraNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/CubeTextureNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/ExtendedMaterialNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/InstanceNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/MaterialNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/MaterialReferenceNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/ModelNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/ModelViewProjectionNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/NormalNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/Object3DNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/PointUVNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/PositionNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/ReferenceNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/ReflectVectorNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/SkinningNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/StorageBufferNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/TangentNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/TextureNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/UserDataNode.js', '/web/node_modules/three/examples/jsm/nodes/accessors/UVNode.js', '/web/node_modules/three/examples/jsm/nodes/code/CodeNode.js', '/web/node_modules/three/examples/jsm/nodes/code/ExpressionNode.js', '/web/node_modules/three/examples/jsm/nodes/code/FunctionCallNode.js', '/web/node_modules/three/examples/jsm/nodes/code/FunctionNode.js', '/web/node_modules/three/examples/jsm/nodes/code/ScriptableNode.js', '/web/node_modules/three/examples/jsm/nodes/code/ScriptableValueNode.js', '/web/node_modules/three/examples/jsm/nodes/core/ArrayUniformNode.js', '/web/node_modules/three/examples/jsm/nodes/core/AttributeNode.js', '/web/node_modules/three/examples/jsm/nodes/core/BypassNode.js', '/web/node_modules/three/examples/jsm/nodes/core/CacheNode.js', '/web/node_modules/three/examples/jsm/nodes/core/constants.js', '/web/node_modules/three/examples/jsm/nodes/core/ConstNode.js', '/web/node_modules/three/examples/jsm/nodes/core/ContextNode.js', '/web/node_modules/three/examples/jsm/nodes/core/InputNode.js', '/web/node_modules/three/examples/jsm/nodes/core/InstanceIndexNode.js', '/web/node_modules/three/examples/jsm/nodes/core/LightingModel.js', '/web/node_modules/three/examples/jsm/nodes/core/Node.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeAttribute.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeBuilder.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeCache.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeCode.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeFrame.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeFunction.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeFunctionInput.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeKeywords.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeParser.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeUniform.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeUtils.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeVar.js', '/web/node_modules/three/examples/jsm/nodes/core/NodeVarying.js', '/web/node_modules/three/examples/jsm/nodes/core/PropertyNode.js', '/web/node_modules/three/examples/jsm/nodes/core/StackNode.js', '/web/node_modules/three/examples/jsm/nodes/core/TempNode.js', '/web/node_modules/three/examples/jsm/nodes/core/UniformNode.js', '/web/node_modules/three/examples/jsm/nodes/core/VarNode.js', '/web/node_modules/three/examples/jsm/nodes/core/VaryingNode.js', '/web/node_modules/three/examples/jsm/nodes/display/BlendModeNode.js', '/web/node_modules/three/examples/jsm/nodes/display/ColorAdjustmentNode.js', '/web/node_modules/three/examples/jsm/nodes/display/ColorSpaceNode.js', '/web/node_modules/three/examples/jsm/nodes/display/FrontFacingNode.js', '/web/node_modules/three/examples/jsm/nodes/display/NormalMapNode.js', '/web/node_modules/three/examples/jsm/nodes/display/PosterizeNode.js', '/web/node_modules/three/examples/jsm/nodes/display/ToneMappingNode.js', '/web/node_modules/three/examples/jsm/nodes/display/ViewportNode.js', '/web/node_modules/three/examples/jsm/nodes/display/ViewportSharedTextureNode.js', '/web/node_modules/three/examples/jsm/nodes/display/ViewportTextureNode.js', '/web/node_modules/three/examples/jsm/nodes/fog/FogExp2Node.js', '/web/node_modules/three/examples/jsm/nodes/fog/FogNode.js', '/web/node_modules/three/examples/jsm/nodes/fog/FogRangeNode.js', '/web/node_modules/three/examples/jsm/nodes/functions/PhongLightingModel.js', '/web/node_modules/three/examples/jsm/nodes/functions/PhysicalLightingModel.js', '/web/node_modules/three/examples/jsm/nodes/functions/BSDF/BRDF_BlinnPhong.js', '/web/node_modules/three/examples/jsm/nodes/functions/BSDF/BRDF_GGX.js', '/web/node_modules/three/examples/jsm/nodes/functions/BSDF/BRDF_Lambert.js', '/web/node_modules/three/examples/jsm/nodes/functions/BSDF/DFGApprox.js', '/web/node_modules/three/examples/jsm/nodes/functions/BSDF/D_GGX.js', '/web/node_modules/three/examples/jsm/nodes/functions/BSDF/F_Schlick.js', '/web/node_modules/three/examples/jsm/nodes/functions/BSDF/V_GGX_SmithCorrelated.js', '/web/node_modules/three/examples/jsm/nodes/functions/material/getGeometryRoughness.js', '/web/node_modules/three/examples/jsm/nodes/functions/material/getRoughness.js', '/web/node_modules/three/examples/jsm/nodes/geometry/RangeNode.js', '/web/node_modules/three/examples/jsm/nodes/gpgpu/ComputeNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/AmbientLightNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/AnalyticLightNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/AONode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/DirectionalLightNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/EnvironmentNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/HemisphereLightNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/IESSpotLightNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/LightingContextNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/LightingNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/LightNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/LightsNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/LightUtils.js', '/web/node_modules/three/examples/jsm/nodes/lighting/PointLightNode.js', '/web/node_modules/three/examples/jsm/nodes/lighting/SpotLightNode.js', '/web/node_modules/three/examples/jsm/nodes/loaders/NodeLoader.js', '/web/node_modules/three/examples/jsm/nodes/loaders/NodeMaterialLoader.js', '/web/node_modules/three/examples/jsm/nodes/loaders/NodeObjectLoader.js', '/web/node_modules/three/examples/jsm/nodes/materials/LineBasicNodeMaterial.js', '/web/node_modules/three/examples/jsm/nodes/materials/Materials.js', '/web/node_modules/three/examples/jsm/nodes/materials/MeshBasicNodeMaterial.js', '/web/node_modules/three/examples/jsm/nodes/materials/MeshNormalNodeMaterial.js', '/web/node_modules/three/examples/jsm/nodes/materials/MeshPhongNodeMaterial.js', '/web/node_modules/three/examples/jsm/nodes/materials/MeshPhysicalNodeMaterial.js', '/web/node_modules/three/examples/jsm/nodes/materials/MeshStandardNodeMaterial.js', '/web/node_modules/three/examples/jsm/nodes/materials/NodeMaterial.js', '/web/node_modules/three/examples/jsm/nodes/materials/PointsNodeMaterial.js', '/web/node_modules/three/examples/jsm/nodes/materials/SpriteNodeMaterial.js', '/web/node_modules/three/examples/jsm/nodes/materialx/MaterialXNodes.js', '/web/node_modules/three/examples/jsm/nodes/materialx/lib/mx_hsv.js', '/web/node_modules/three/examples/jsm/nodes/materialx/lib/mx_noise.js', '/web/node_modules/three/examples/jsm/nodes/materialx/lib/mx_transform_color.js', '/web/node_modules/three/examples/jsm/nodes/math/CondNode.js', '/web/node_modules/three/examples/jsm/nodes/math/MathNode.js', '/web/node_modules/three/examples/jsm/nodes/math/OperatorNode.js', '/web/node_modules/three/examples/jsm/nodes/parsers/GLSLNodeFunction.js', '/web/node_modules/three/examples/jsm/nodes/parsers/GLSLNodeParser.js', '/web/node_modules/three/examples/jsm/nodes/procedural/CheckerNode.js', '/web/node_modules/three/examples/jsm/nodes/shadernode/ShaderNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/ArrayElementNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/ConvertNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/DiscardNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/EquirectUVNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/JoinNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/LoopNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/MatcapUVNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/MaxMipLevelNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/OscNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/PackingNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/RemapNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/RotateUVNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/SpecularMIPLevelNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/SplitNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/SpriteSheetUVNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/TimerNode.js', '/web/node_modules/three/examples/jsm/nodes/utils/TriplanarTexturesNode.js', '/web/node_modules/three/examples/jsm/objects/GroundProjectedSkybox.js', '/web/node_modules/three/examples/jsm/objects/Lensflare.js', '/web/node_modules/three/examples/jsm/objects/MarchingCubes.js', '/web/node_modules/three/examples/jsm/objects/Reflector.js', '/web/node_modules/three/examples/jsm/objects/ReflectorForSSRPass.js', '/web/node_modules/three/examples/jsm/objects/Refractor.js', '/web/node_modules/three/examples/jsm/objects/ShadowMesh.js', '/web/node_modules/three/examples/jsm/objects/Sky.js', '/web/node_modules/three/examples/jsm/objects/Water.js', '/web/node_modules/three/examples/jsm/objects/Water2.js', '/web/node_modules/three/examples/jsm/offscreen/jank.js', '/web/node_modules/three/examples/jsm/offscreen/offscreen.js', '/web/node_modules/three/examples/jsm/offscreen/scene.js', '/web/node_modules/three/examples/jsm/physics/AmmoPhysics.js', '/web/node_modules/three/examples/jsm/physics/RapierPhysics.js', '/web/node_modules/three/examples/jsm/postprocessing/AfterimagePass.js', '/web/node_modules/three/examples/jsm/postprocessing/BloomPass.js', '/web/node_modules/three/examples/jsm/postprocessing/BokehPass.js', '/web/node_modules/three/examples/jsm/postprocessing/ClearPass.js', '/web/node_modules/three/examples/jsm/postprocessing/CubeTexturePass.js', '/web/node_modules/three/examples/jsm/postprocessing/DotScreenPass.js', '/web/node_modules/three/examples/jsm/postprocessing/EffectComposer.js', '/web/node_modules/three/examples/jsm/postprocessing/FilmPass.js', '/web/node_modules/three/examples/jsm/postprocessing/GlitchPass.js', '/web/node_modules/three/examples/jsm/postprocessing/HalftonePass.js', '/web/node_modules/three/examples/jsm/postprocessing/LUTPass.js', '/web/node_modules/three/examples/jsm/postprocessing/MaskPass.js', '/web/node_modules/three/examples/jsm/postprocessing/OutlinePass.js', '/web/node_modules/three/examples/jsm/postprocessing/OutputPass.js', '/web/node_modules/three/examples/jsm/postprocessing/Pass.js', '/web/node_modules/three/examples/jsm/postprocessing/RenderPass.js', '/web/node_modules/three/examples/jsm/postprocessing/RenderPixelatedPass.js', '/web/node_modules/three/examples/jsm/postprocessing/SAOPass.js', '/web/node_modules/three/examples/jsm/postprocessing/SavePass.js', '/web/node_modules/three/examples/jsm/postprocessing/ShaderPass.js', '/web/node_modules/three/examples/jsm/postprocessing/SMAAPass.js', '/web/node_modules/three/examples/jsm/postprocessing/SSAARenderPass.js', '/web/node_modules/three/examples/jsm/postprocessing/SSAOPass.js', '/web/node_modules/three/examples/jsm/postprocessing/SSRPass.js', '/web/node_modules/three/examples/jsm/postprocessing/TAARenderPass.js', '/web/node_modules/three/examples/jsm/postprocessing/TexturePass.js', '/web/node_modules/three/examples/jsm/postprocessing/UnrealBloomPass.js', '/web/node_modules/three/examples/jsm/renderers/CSS2DRenderer.js', '/web/node_modules/three/examples/jsm/renderers/CSS3DRenderer.js', '/web/node_modules/three/examples/jsm/renderers/Projector.js', '/web/node_modules/three/examples/jsm/renderers/SVGRenderer.js', '/web/node_modules/three/examples/jsm/renderers/common/Animation.js', '/web/node_modules/three/examples/jsm/renderers/common/Attributes.js', '/web/node_modules/three/examples/jsm/renderers/common/Backend.js', '/web/node_modules/three/examples/jsm/renderers/common/Background.js', '/web/node_modules/three/examples/jsm/renderers/common/Binding.js', '/web/node_modules/three/examples/jsm/renderers/common/Bindings.js', '/web/node_modules/three/examples/jsm/renderers/common/Buffer.js', '/web/node_modules/three/examples/jsm/renderers/common/BufferUtils.js', '/web/node_modules/three/examples/jsm/renderers/common/ChainMap.js', '/web/node_modules/three/examples/jsm/renderers/common/ComputePipeline.js', '/web/node_modules/three/examples/jsm/renderers/common/Constants.js', '/web/node_modules/three/examples/jsm/renderers/common/CubeRenderTarget.js', '/web/node_modules/three/examples/jsm/renderers/common/DataMap.js', '/web/node_modules/three/examples/jsm/renderers/common/Geometries.js', '/web/node_modules/three/examples/jsm/renderers/common/Info.js', '/web/node_modules/three/examples/jsm/renderers/common/Pipeline.js', '/web/node_modules/three/examples/jsm/renderers/common/Pipelines.js', '/web/node_modules/three/examples/jsm/renderers/common/ProgrammableStage.js', '/web/node_modules/three/examples/jsm/renderers/common/RenderContext.js', '/web/node_modules/three/examples/jsm/renderers/common/RenderContexts.js', '/web/node_modules/three/examples/jsm/renderers/common/Renderer.js', '/web/node_modules/three/examples/jsm/renderers/common/RenderList.js', '/web/node_modules/three/examples/jsm/renderers/common/RenderLists.js', '/web/node_modules/three/examples/jsm/renderers/common/RenderObject.js', '/web/node_modules/three/examples/jsm/renderers/common/RenderObjects.js', '/web/node_modules/three/examples/jsm/renderers/common/RenderPipeline.js', '/web/node_modules/three/examples/jsm/renderers/common/RenderTarget.js', '/web/node_modules/three/examples/jsm/renderers/common/SampledTexture.js', '/web/node_modules/three/examples/jsm/renderers/common/Sampler.js', '/web/node_modules/three/examples/jsm/renderers/common/StorageBuffer.js', '/web/node_modules/three/examples/jsm/renderers/common/Textures.js', '/web/node_modules/three/examples/jsm/renderers/common/Uniform.js', '/web/node_modules/three/examples/jsm/renderers/common/UniformBuffer.js', '/web/node_modules/three/examples/jsm/renderers/common/UniformsGroup.js', '/web/node_modules/three/examples/jsm/renderers/common/nodes/NodeRender.js', '/web/node_modules/three/examples/jsm/renderers/common/nodes/Nodes.js', '/web/node_modules/three/examples/jsm/renderers/common/nodes/NodeSampledTexture.js', '/web/node_modules/three/examples/jsm/renderers/common/nodes/NodeSampler.js', '/web/node_modules/three/examples/jsm/renderers/common/nodes/NodeUniform.js', '/web/node_modules/three/examples/jsm/renderers/webgl/nodes/SlotNode.js', '/web/node_modules/three/examples/jsm/renderers/webgl/nodes/WebGLNodeBuilder.js', '/web/node_modules/three/examples/jsm/renderers/webgl/nodes/WebGLNodes.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/WebGPUBackend.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/WebGPURenderer.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/nodes/WGSLNodeBuilder.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/nodes/WGSLNodeFunction.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/nodes/WGSLNodeParser.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/utils/WebGPUAttributeUtils.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/utils/WebGPUBindingUtils.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/utils/WebGPUConstants.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/utils/WebGPUPipelineUtils.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/utils/WebGPUTextureMipmapUtils.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/utils/WebGPUTextureUtils.js', '/web/node_modules/three/examples/jsm/renderers/webgpu/utils/WebGPUUtils.js', '/web/node_modules/three/examples/jsm/shaders/ACESFilmicToneMappingShader.js', '/web/node_modules/three/examples/jsm/shaders/AfterimageShader.js', '/web/node_modules/three/examples/jsm/shaders/BasicShader.js', '/web/node_modules/three/examples/jsm/shaders/BleachBypassShader.js', '/web/node_modules/three/examples/jsm/shaders/BlendShader.js', '/web/node_modules/three/examples/jsm/shaders/BokehShader.js', '/web/node_modules/three/examples/jsm/shaders/BokehShader2.js', '/web/node_modules/three/examples/jsm/shaders/BrightnessContrastShader.js', '/web/node_modules/three/examples/jsm/shaders/ColorCorrectionShader.js', '/web/node_modules/three/examples/jsm/shaders/ColorifyShader.js', '/web/node_modules/three/examples/jsm/shaders/ConvolutionShader.js', '/web/node_modules/three/examples/jsm/shaders/CopyShader.js', '/web/node_modules/three/examples/jsm/shaders/DepthLimitedBlurShader.js', '/web/node_modules/three/examples/jsm/shaders/DigitalGlitch.js', '/web/node_modules/three/examples/jsm/shaders/DOFMipMapShader.js', '/web/node_modules/three/examples/jsm/shaders/DotScreenShader.js', '/web/node_modules/three/examples/jsm/shaders/ExposureShader.js', '/web/node_modules/three/examples/jsm/shaders/FilmShader.js', '/web/node_modules/three/examples/jsm/shaders/FocusShader.js', '/web/node_modules/three/examples/jsm/shaders/FreiChenShader.js', '/web/node_modules/three/examples/jsm/shaders/FXAAShader.js', '/web/node_modules/three/examples/jsm/shaders/GammaCorrectionShader.js', '/web/node_modules/three/examples/jsm/shaders/GodRaysShader.js', '/web/node_modules/three/examples/jsm/shaders/HalftoneShader.js', '/web/node_modules/three/examples/jsm/shaders/HorizontalBlurShader.js', '/web/node_modules/three/examples/jsm/shaders/HorizontalTiltShiftShader.js', '/web/node_modules/three/examples/jsm/shaders/HueSaturationShader.js', '/web/node_modules/three/examples/jsm/shaders/KaleidoShader.js', '/web/node_modules/three/examples/jsm/shaders/LuminosityHighPassShader.js', '/web/node_modules/three/examples/jsm/shaders/LuminosityShader.js', '/web/node_modules/three/examples/jsm/shaders/MirrorShader.js', '/web/node_modules/three/examples/jsm/shaders/MMDToonShader.js', '/web/node_modules/three/examples/jsm/shaders/NormalMapShader.js', '/web/node_modules/three/examples/jsm/shaders/OutputShader.js', '/web/node_modules/three/examples/jsm/shaders/RGBShiftShader.js', '/web/node_modules/three/examples/jsm/shaders/SAOShader.js', '/web/node_modules/three/examples/jsm/shaders/SepiaShader.js', '/web/node_modules/three/examples/jsm/shaders/SMAAShader.js', '/web/node_modules/three/examples/jsm/shaders/SobelOperatorShader.js', '/web/node_modules/three/examples/jsm/shaders/SSAOShader.js', '/web/node_modules/three/examples/jsm/shaders/SSRShader.js', '/web/node_modules/three/examples/jsm/shaders/SubsurfaceScatteringShader.js', '/web/node_modules/three/examples/jsm/shaders/TechnicolorShader.js', '/web/node_modules/three/examples/jsm/shaders/ToonShader.js', '/web/node_modules/three/examples/jsm/shaders/TriangleBlurShader.js', '/web/node_modules/three/examples/jsm/shaders/UnpackDepthRGBAShader.js', '/web/node_modules/three/examples/jsm/shaders/VelocityShader.js', '/web/node_modules/three/examples/jsm/shaders/VerticalBlurShader.js', '/web/node_modules/three/examples/jsm/shaders/VerticalTiltShiftShader.js', '/web/node_modules/three/examples/jsm/shaders/VignetteShader.js', '/web/node_modules/three/examples/jsm/shaders/VolumeShader.js', '/web/node_modules/three/examples/jsm/shaders/WaterRefractionShader.js', '/web/node_modules/three/examples/jsm/textures/FlakesTexture.js', '/web/node_modules/three/examples/jsm/utils/BufferGeometryUtils.js', '/web/node_modules/three/examples/jsm/utils/CameraUtils.js', '/web/node_modules/three/examples/jsm/utils/GeometryCompressionUtils.js', '/web/node_modules/three/examples/jsm/utils/GeometryUtils.js', '/web/node_modules/three/examples/jsm/utils/GPUStatsPanel.js', '/web/node_modules/three/examples/jsm/utils/LDrawUtils.js', '/web/node_modules/three/examples/jsm/utils/PackedPhongMaterial.js', '/web/node_modules/three/examples/jsm/utils/SceneUtils.js', '/web/node_modules/three/examples/jsm/utils/ShadowMapViewer.js', '/web/node_modules/three/examples/jsm/utils/SkeletonUtils.js', '/web/node_modules/three/examples/jsm/utils/TextureUtils.js', '/web/node_modules/three/examples/jsm/utils/UVsDebug.js', '/web/node_modules/three/examples/jsm/utils/WorkerPool.js', '/web/node_modules/three/examples/jsm/webxr/ARButton.js', '/web/node_modules/three/examples/jsm/webxr/OculusHandModel.js', '/web/node_modules/three/examples/jsm/webxr/OculusHandPointerModel.js', '/web/node_modules/three/examples/jsm/webxr/Text2D.js', '/web/node_modules/three/examples/jsm/webxr/VRButton.js', '/web/node_modules/three/examples/jsm/webxr/XRButton.js', '/web/node_modules/three/examples/jsm/webxr/XRControllerModelFactory.js', '/web/node_modules/three/examples/jsm/webxr/XREstimatedLight.js', '/web/node_modules/three/examples/jsm/webxr/XRHandMeshModel.js', '/web/node_modules/three/examples/jsm/webxr/XRHandModelFactory.js', '/web/node_modules/three/examples/jsm/webxr/XRHandPrimitiveModel.js', '/web/node_modules/three/examples/jsm/webxr/XRPlanes.js', '/web/node_modules/three/src/constants.js', '/web/node_modules/three/src/Three.js', '/web/node_modules/three/src/Three.Legacy.js', '/web/node_modules/three/src/utils.js', '/web/node_modules/three/src/animation/AnimationAction.js', '/web/node_modules/three/src/animation/AnimationClip.js', '/web/node_modules/three/src/animation/AnimationMixer.js', '/web/node_modules/three/src/animation/AnimationObjectGroup.js', '/web/node_modules/three/src/animation/AnimationUtils.js', '/web/node_modules/three/src/animation/KeyframeTrack.js', '/web/node_modules/three/src/animation/PropertyBinding.js', '/web/node_modules/three/src/animation/PropertyMixer.js', '/web/node_modules/three/src/animation/tracks/BooleanKeyframeTrack.js', '/web/node_modules/three/src/animation/tracks/ColorKeyframeTrack.js', '/web/node_modules/three/src/animation/tracks/NumberKeyframeTrack.js', '/web/node_modules/three/src/animation/tracks/QuaternionKeyframeTrack.js', '/web/node_modules/three/src/animation/tracks/StringKeyframeTrack.js', '/web/node_modules/three/src/animation/tracks/VectorKeyframeTrack.js', '/web/node_modules/three/src/audio/Audio.js', '/web/node_modules/three/src/audio/AudioAnalyser.js', '/web/node_modules/three/src/audio/AudioContext.js', '/web/node_modules/three/src/audio/AudioListener.js', '/web/node_modules/three/src/audio/PositionalAudio.js', '/web/node_modules/three/src/cameras/ArrayCamera.js', '/web/node_modules/three/src/cameras/Camera.js', '/web/node_modules/three/src/cameras/CubeCamera.js', '/web/node_modules/three/src/cameras/OrthographicCamera.js', '/web/node_modules/three/src/cameras/PerspectiveCamera.js', '/web/node_modules/three/src/cameras/StereoCamera.js', '/web/node_modules/three/src/core/BufferAttribute.js', '/web/node_modules/three/src/core/BufferGeometry.js', '/web/node_modules/three/src/core/Clock.js', '/web/node_modules/three/src/core/EventDispatcher.js', '/web/node_modules/three/src/core/GLBufferAttribute.js', '/web/node_modules/three/src/core/InstancedBufferAttribute.js', '/web/node_modules/three/src/core/InstancedBufferGeometry.js', '/web/node_modules/three/src/core/InstancedInterleavedBuffer.js', '/web/node_modules/three/src/core/InterleavedBuffer.js', '/web/node_modules/three/src/core/InterleavedBufferAttribute.js', '/web/node_modules/three/src/core/Layers.js', '/web/node_modules/three/src/core/Object3D.js', '/web/node_modules/three/src/core/Raycaster.js', '/web/node_modules/three/src/core/Uniform.js', '/web/node_modules/three/src/core/UniformsGroup.js', '/web/node_modules/three/src/extras/DataUtils.js', '/web/node_modules/three/src/extras/Earcut.js', '/web/node_modules/three/src/extras/ImageUtils.js', '/web/node_modules/three/src/extras/PMREMGenerator.js', '/web/node_modules/three/src/extras/ShapeUtils.js', '/web/node_modules/three/src/extras/core/Curve.js', '/web/node_modules/three/src/extras/core/CurvePath.js', '/web/node_modules/three/src/extras/core/Interpolations.js', '/web/node_modules/three/src/extras/core/Path.js', '/web/node_modules/three/src/extras/core/Shape.js', '/web/node_modules/three/src/extras/core/ShapePath.js', '/web/node_modules/three/src/extras/curves/ArcCurve.js', '/web/node_modules/three/src/extras/curves/CatmullRomCurve3.js', '/web/node_modules/three/src/extras/curves/CubicBezierCurve.js', '/web/node_modules/three/src/extras/curves/CubicBezierCurve3.js', '/web/node_modules/three/src/extras/curves/Curves.js', '/web/node_modules/three/src/extras/curves/EllipseCurve.js', '/web/node_modules/three/src/extras/curves/LineCurve.js', '/web/node_modules/three/src/extras/curves/LineCurve3.js', '/web/node_modules/three/src/extras/curves/QuadraticBezierCurve.js', '/web/node_modules/three/src/extras/curves/QuadraticBezierCurve3.js', '/web/node_modules/three/src/extras/curves/SplineCurve.js', '/web/node_modules/three/src/geometries/BoxGeometry.js', '/web/node_modules/three/src/geometries/CapsuleGeometry.js', '/web/node_modules/three/src/geometries/CircleGeometry.js', '/web/node_modules/three/src/geometries/ConeGeometry.js', '/web/node_modules/three/src/geometries/CylinderGeometry.js', '/web/node_modules/three/src/geometries/DodecahedronGeometry.js', '/web/node_modules/three/src/geometries/EdgesGeometry.js', '/web/node_modules/three/src/geometries/ExtrudeGeometry.js', '/web/node_modules/three/src/geometries/Geometries.js', '/web/node_modules/three/src/geometries/IcosahedronGeometry.js', '/web/node_modules/three/src/geometries/LatheGeometry.js', '/web/node_modules/three/src/geometries/OctahedronGeometry.js', '/web/node_modules/three/src/geometries/PlaneGeometry.js', '/web/node_modules/three/src/geometries/PolyhedronGeometry.js', '/web/node_modules/three/src/geometries/RingGeometry.js', '/web/node_modules/three/src/geometries/ShapeGeometry.js', '/web/node_modules/three/src/geometries/SphereGeometry.js', '/web/node_modules/three/src/geometries/TetrahedronGeometry.js', '/web/node_modules/three/src/geometries/TorusGeometry.js', '/web/node_modules/three/src/geometries/TorusKnotGeometry.js', '/web/node_modules/three/src/geometries/TubeGeometry.js', '/web/node_modules/three/src/geometries/WireframeGeometry.js', '/web/node_modules/three/src/helpers/ArrowHelper.js', '/web/node_modules/three/src/helpers/AxesHelper.js', '/web/node_modules/three/src/helpers/Box3Helper.js', '/web/node_modules/three/src/helpers/BoxHelper.js', '/web/node_modules/three/src/helpers/CameraHelper.js', '/web/node_modules/three/src/helpers/DirectionalLightHelper.js', '/web/node_modules/three/src/helpers/GridHelper.js', '/web/node_modules/three/src/helpers/HemisphereLightHelper.js', '/web/node_modules/three/src/helpers/PlaneHelper.js', '/web/node_modules/three/src/helpers/PointLightHelper.js', '/web/node_modules/three/src/helpers/PolarGridHelper.js', '/web/node_modules/three/src/helpers/SkeletonHelper.js', '/web/node_modules/three/src/helpers/SpotLightHelper.js', '/web/node_modules/three/src/lights/AmbientLight.js', '/web/node_modules/three/src/lights/AmbientLightProbe.js', '/web/node_modules/three/src/lights/DirectionalLight.js', '/web/node_modules/three/src/lights/DirectionalLightShadow.js', '/web/node_modules/three/src/lights/HemisphereLight.js', '/web/node_modules/three/src/lights/HemisphereLightProbe.js', '/web/node_modules/three/src/lights/Light.js', '/web/node_modules/three/src/lights/LightProbe.js', '/web/node_modules/three/src/lights/LightShadow.js', '/web/node_modules/three/src/lights/PointLight.js', '/web/node_modules/three/src/lights/PointLightShadow.js', '/web/node_modules/three/src/lights/RectAreaLight.js', '/web/node_modules/three/src/lights/SpotLight.js', '/web/node_modules/three/src/lights/SpotLightShadow.js', '/web/node_modules/three/src/loaders/AnimationLoader.js', '/web/node_modules/three/src/loaders/AudioLoader.js', '/web/node_modules/three/src/loaders/BufferGeometryLoader.js', '/web/node_modules/three/src/loaders/Cache.js', '/web/node_modules/three/src/loaders/CompressedTextureLoader.js', '/web/node_modules/three/src/loaders/CubeTextureLoader.js', '/web/node_modules/three/src/loaders/DataTextureLoader.js', '/web/node_modules/three/src/loaders/FileLoader.js', '/web/node_modules/three/src/loaders/ImageBitmapLoader.js', '/web/node_modules/three/src/loaders/ImageLoader.js', '/web/node_modules/three/src/loaders/Loader.js', '/web/node_modules/three/src/loaders/LoaderUtils.js', '/web/node_modules/three/src/loaders/LoadingManager.js', '/web/node_modules/three/src/loaders/MaterialLoader.js', '/web/node_modules/three/src/loaders/ObjectLoader.js', '/web/node_modules/three/src/loaders/TextureLoader.js', '/web/node_modules/three/src/materials/LineBasicMaterial.js', '/web/node_modules/three/src/materials/LineDashedMaterial.js', '/web/node_modules/three/src/materials/Material.js', '/web/node_modules/three/src/materials/Materials.js', '/web/node_modules/three/src/materials/MeshBasicMaterial.js', '/web/node_modules/three/src/materials/MeshDepthMaterial.js', '/web/node_modules/three/src/materials/MeshDistanceMaterial.js', '/web/node_modules/three/src/materials/MeshLambertMaterial.js', '/web/node_modules/three/src/materials/MeshMatcapMaterial.js', '/web/node_modules/three/src/materials/MeshNormalMaterial.js', '/web/node_modules/three/src/materials/MeshPhongMaterial.js', '/web/node_modules/three/src/materials/MeshPhysicalMaterial.js', '/web/node_modules/three/src/materials/MeshStandardMaterial.js', '/web/node_modules/three/src/materials/MeshToonMaterial.js', '/web/node_modules/three/src/materials/PointsMaterial.js', '/web/node_modules/three/src/materials/RawShaderMaterial.js', '/web/node_modules/three/src/materials/ShaderMaterial.js', '/web/node_modules/three/src/materials/ShadowMaterial.js', '/web/node_modules/three/src/materials/SpriteMaterial.js', '/web/node_modules/three/src/math/Box2.js', '/web/node_modules/three/src/math/Box3.js', '/web/node_modules/three/src/math/Color.js', '/web/node_modules/three/src/math/ColorManagement.js', '/web/node_modules/three/src/math/Cylindrical.js', '/web/node_modules/three/src/math/Euler.js', '/web/node_modules/three/src/math/Frustum.js', '/web/node_modules/three/src/math/Interpolant.js', '/web/node_modules/three/src/math/Line3.js', '/web/node_modules/three/src/math/MathUtils.js', '/web/node_modules/three/src/math/Matrix3.js', '/web/node_modules/three/src/math/Matrix4.js', '/web/node_modules/three/src/math/Plane.js', '/web/node_modules/three/src/math/Quaternion.js', '/web/node_modules/three/src/math/Ray.js', '/web/node_modules/three/src/math/Sphere.js', '/web/node_modules/three/src/math/Spherical.js', '/web/node_modules/three/src/math/SphericalHarmonics3.js', '/web/node_modules/three/src/math/Triangle.js', '/web/node_modules/three/src/math/Vector2.js', '/web/node_modules/three/src/math/Vector3.js', '/web/node_modules/three/src/math/Vector4.js', '/web/node_modules/three/src/math/interpolants/CubicInterpolant.js', '/web/node_modules/three/src/math/interpolants/DiscreteInterpolant.js', '/web/node_modules/three/src/math/interpolants/LinearInterpolant.js', '/web/node_modules/three/src/math/interpolants/QuaternionLinearInterpolant.js', '/web/node_modules/three/src/objects/Bone.js', '/web/node_modules/three/src/objects/Group.js', '/web/node_modules/three/src/objects/InstancedMesh.js', '/web/node_modules/three/src/objects/Line.js', '/web/node_modules/three/src/objects/LineLoop.js', '/web/node_modules/three/src/objects/LineSegments.js', '/web/node_modules/three/src/objects/LOD.js', '/web/node_modules/three/src/objects/Mesh.js', '/web/node_modules/three/src/objects/Points.js', '/web/node_modules/three/src/objects/Skeleton.js', '/web/node_modules/three/src/objects/SkinnedMesh.js', '/web/node_modules/three/src/objects/Sprite.js', '/web/node_modules/three/src/renderers/WebGL1Renderer.js', '/web/node_modules/three/src/renderers/WebGL3DRenderTarget.js', '/web/node_modules/three/src/renderers/WebGLArrayRenderTarget.js', '/web/node_modules/three/src/renderers/WebGLCubeRenderTarget.js', '/web/node_modules/three/src/renderers/WebGLMultipleRenderTargets.js', '/web/node_modules/three/src/renderers/WebGLRenderer.js', '/web/node_modules/three/src/renderers/WebGLRenderTarget.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib.js', '/web/node_modules/three/src/renderers/shaders/UniformsLib.js', '/web/node_modules/three/src/renderers/shaders/UniformsUtils.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/alphatest_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/aomap_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/aomap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/beginnormal_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/begin_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/bsdfs.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/clearcoat_normal_fragment_begin.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/clearcoat_normal_fragment_maps.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/clearcoat_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/clipping_planes_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/clipping_planes_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/clipping_planes_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/clipping_planes_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/color_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/color_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/common.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/cube_uv_reflection_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/default_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/default_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/displacementmap_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/displacementmap_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/dithering_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/dithering_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/emissivemap_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/emissivemap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/encodings_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/encodings_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/envmap_common_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/envmap_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/envmap_physical_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/envmap_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/fog_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/fog_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/fog_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/gradientmap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/iridescence_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/iridescence_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_fragment_begin.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_fragment_end.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_fragment_maps.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_lambert_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_lambert_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_pars_begin.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_physical_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_physical_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_toon_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/lights_toon_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/map_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/metalnessmap_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/metalnessmap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/morphcolor_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/normal_fragment_begin.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/normal_fragment_maps.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/normal_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/normal_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/normal_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/output_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/packing.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/premultiplied_alpha_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/project_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/roughnessmap_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/roughnessmap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/shadowmask_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/skinning_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/tonemapping_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/tonemapping_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/transmission_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/transmission_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/uv_pars_fragment.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/uv_pars_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/uv_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/background.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/backgroundCube.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/cube.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/depth.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/distanceRGBA.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/equirect.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/linedashed.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/meshbasic.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/meshlambert.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/meshmatcap.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/meshnormal.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/meshphong.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/meshphysical.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/meshtoon.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/points.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/shadow.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/sprite.glsl.js', '/web/node_modules/three/src/renderers/shaders/ShaderLib/vsm.glsl.js', '/web/node_modules/three/src/renderers/webgl/WebGLAnimation.js', '/web/node_modules/three/src/renderers/webgl/WebGLAttributes.js', '/web/node_modules/three/src/renderers/webgl/WebGLBackground.js', '/web/node_modules/three/src/renderers/webgl/WebGLBindingStates.js', '/web/node_modules/three/src/renderers/webgl/WebGLBufferRenderer.js', '/web/node_modules/three/src/renderers/webgl/WebGLCapabilities.js', '/web/node_modules/three/src/renderers/webgl/WebGLClipping.js', '/web/node_modules/three/src/renderers/webgl/WebGLCubeMaps.js', '/web/node_modules/three/src/renderers/webgl/WebGLCubeUVMaps.js', '/web/node_modules/three/src/renderers/webgl/WebGLExtensions.js', '/web/node_modules/three/src/renderers/webgl/WebGLGeometries.js', '/web/node_modules/three/src/renderers/webgl/WebGLIndexedBufferRenderer.js', '/web/node_modules/three/src/renderers/webgl/WebGLInfo.js', '/web/node_modules/three/src/renderers/webgl/WebGLLights.js', '/web/node_modules/three/src/renderers/webgl/WebGLMaterials.js', '/web/node_modules/three/src/renderers/webgl/WebGLMorphtargets.js', '/web/node_modules/three/src/renderers/webgl/WebGLObjects.js', '/web/node_modules/three/src/renderers/webgl/WebGLProgram.js', '/web/node_modules/three/src/renderers/webgl/WebGLPrograms.js', '/web/node_modules/three/src/renderers/webgl/WebGLProperties.js', '/web/node_modules/three/src/renderers/webgl/WebGLRenderLists.js', '/web/node_modules/three/src/renderers/webgl/WebGLRenderStates.js', '/web/node_modules/three/src/renderers/webgl/WebGLShader.js', '/web/node_modules/three/src/renderers/webgl/WebGLShaderCache.js', '/web/node_modules/three/src/renderers/webgl/WebGLShadowMap.js', '/web/node_modules/three/src/renderers/webgl/WebGLState.js', '/web/node_modules/three/src/renderers/webgl/WebGLTextures.js', '/web/node_modules/three/src/renderers/webgl/WebGLUniforms.js', '/web/node_modules/three/src/renderers/webgl/WebGLUniformsGroups.js', '/web/node_modules/three/src/renderers/webgl/WebGLUtils.js', '/web/node_modules/three/src/renderers/webxr/WebXRController.js', '/web/node_modules/three/src/renderers/webxr/WebXRManager.js', '/web/node_modules/three/src/scenes/Fog.js', '/web/node_modules/three/src/scenes/FogExp2.js', '/web/node_modules/three/src/scenes/Scene.js', '/web/node_modules/three/src/textures/CanvasTexture.js', '/web/node_modules/three/src/textures/CompressedArrayTexture.js', '/web/node_modules/three/src/textures/CompressedTexture.js', '/web/node_modules/three/src/textures/CubeTexture.js', '/web/node_modules/three/src/textures/Data3DTexture.js', '/web/node_modules/three/src/textures/DataArrayTexture.js', '/web/node_modules/three/src/textures/DataTexture.js', '/web/node_modules/three/src/textures/DepthTexture.js', '/web/node_modules/three/src/textures/FramebufferTexture.js', '/web/node_modules/three/src/textures/Source.js', '/web/node_modules/three/src/textures/Texture.js', '/web/node_modules/three/src/textures/VideoTexture.js',

    // The very long list of three.js files:
    // If using Three.js via CDN or a large library, be selective or use workbox for better strategies.
    // Caching all node_modules like this is generally not recommended for performance/size.
    // Prefer bundling critical three.js parts or using workbox strategies for node_modules.
    // For demonstration, I'll keep a few, but the full list is too large for optimal SW.
    '/web/node_modules/three/build/three.module.js',
    // ... (selectively add other three.js examples if absolutely needed for offline core functionality)
];

const ALL_ASSETS_TO_CACHE = [...new Set([...CORE_ASSETS_TO_CACHE, ...APP_SPECIFIC_ASSETS])];


// Files to be fetched with a network-first strategy (prefer fresh, fallback to cache)
// Typically includes the main HTML entry points or dynamic content routes if they can be cached.
const NETWORK_FIRST_PATHS = [
    "/", // Root path, usually index.html
    "/index.html",
    "/web/core0/index.html", // Example main content page
    // Add other paths that should always try network first
];

self.addEventListener("install", event => {
    swLog(`Installing version ${CACHE_NAME}`);
    event.waitUntil(
        caches.open(CACHE_NAME)
            .then(cache => {
                swLog("Caching core assets...");
                return cache.addAll(ALL_ASSETS_TO_CACHE)
                    .catch(error => {
                        swError("Failed to cache some core assets during install:", error);
                        // Decide if this is a critical failure. For some assets, it might be.
                    });
            })
            .then(() => self.skipWaiting())
            .catch(error => {
                swError("Cache open or skipWaiting failed during install:", error);
            })
    );
});

self.addEventListener("activate", event => {
    swLog(`Activating version ${CACHE_NAME}. Cleaning old caches.`);
    event.waitUntil(
        caches.keys().then(cacheNames => {
            return Promise.all(
                cacheNames.map(name => {
                    if (name !== CACHE_NAME) {
                        swLog(`Deleting old cache: ${name}`);
                        return caches.delete(name);
                    }
                })
            );
        }).then(() => {
            swLog("Old caches cleaned.");
            return self.clients.claim();
        }).catch(error => {
            swError("Cache cleanup or clients.claim failed during activate:", error);
        })
    );
});

self.addEventListener("fetch", event => {
    const url = new URL(event.request.url);

    // Ignore non-GET requests
    if (event.request.method !== "GET") {
        return;
    }

    // Ignore requests to other origins (e.g. CDNs, analytics, APIs)
    // unless specifically handled. For APIs, consider a network-first or network-only strategy.
    if (url.origin !== self.location.origin) {
        // Example: allow caching for specific CDN resources if needed
        // if (url.hostname === 'cdn.example.com') { /* handle */ }
        return; // Let browser handle by default
    }

    // Ignore analytics, WebSocket, etc.
    if (event.request.url.includes('analytics') || event.request.url.includes('sockjs') || url.protocol === 'ws:' || url.protocol === 'wss:') {
        return; // Let browser handle (network only)
    }


    // Network-first strategy for specified paths
    if (NETWORK_FIRST_PATHS.includes(url.pathname)) {
        event.respondWith(networkElseCache(event));
        return;
    }

    // Cache-first (stale-while-revalidate like) strategy for other assets (implicitly, those in ALL_ASSETS_TO_CACHE)
    // Or more generally, any same-origin GET request not handled above.
    event.respondWith(cacheElseNetwork(event));
});


function cacheElseNetwork(event) {
    return caches.match(event.request).then(cachedResponse => {
        // Fetch from network in parallel to update cache (stale-while-revalidate)
        const fetchPromise = fetch(event.request)
            .then(networkResponse => {
                if (networkResponse.ok) {
                    const responseToCache = networkResponse.clone();
                    caches.open(CACHE_NAME).then(cache => {
                        cache.put(event.request, responseToCache);
                    });
                }
                return networkResponse;
            })
            .catch(error => {
                swWarn(`Network fetch failed in cacheElseNetwork for ${event.request.url}: ${error.message}`);
                // If not in cache and network fails, this will propagate the error.
                // If it was in cache, the cachedResponse is already returned.
            });

        if (cachedResponse) {
            // swLog(`Serving from cache: ${event.request.url}`);
            return cachedResponse;
        }

        // swLog(`Not in cache, fetching from network: ${event.request.url}`);
        return fetchPromise; // Return the network request promise (which might fail)
    }).catch(error => {
        swError(`Error in cacheElseNetwork for ${event.request.url}: ${error.message}`);
        // Fallback for navigation requests if everything fails
        if (event.request.mode === 'navigate') {
            return caches.match(OFFLINE_URL);
        }
        // For other assets, let the browser handle the error (e.g. broken image icon)
        // Or return a generic error response:
        // return new Response(`Failed to retrieve ${event.request.url}`, { status: 503, statusText: "Service Unavailable" });
    });
}

function networkElseCache(event) {
    return fetch(event.request)
        .then(networkResponse => {
            // swLog(`Serving from network: ${event.request.url}`);
            if (networkResponse.ok) { // Cache only successful responses
                const responseToCache = networkResponse.clone();
                caches.open(CACHE_NAME).then(cache => {
                    cache.put(event.request, responseToCache);
                });
            }
            return networkResponse;
        })
        .catch(error => {
            swWarn(`Network request failed for ${event.request.url}. Attempting cache. Error: ${error.message}`);
            return caches.match(event.request).then(cachedResponse => {
                if (cachedResponse) {
                    // swLog(`Serving from cache (fallback): ${event.request.url}`);
                    return cachedResponse;
                }
                // If navigate and nothing in cache, return offline page
                if (event.request.mode === 'navigate') {
                    swLog(`Network failed, not in cache. Serving offline page for navigation to ${event.request.url}`);
                    return caches.match(OFFLINE_URL);
                }
                swWarn(`Network failed, not in cache, and not a navigation request: ${event.request.url}`);
                // For assets, if not in cache and network fails, let it fail (browser default)
                // Or return a generic error response:
                return new Response(`Network error and resource not found in cache: ${event.request.url}`, {
                    status: 404, // Or 503
                    statusText: "Not Found in Cache or Network"
                });
            });
        });
}

// Optional: Listen for messages from clients
self.addEventListener('message', (event) => {
    swLog(`Received message from client:`, event.data);
    if (event.data && event.data.type === 'SKIP_WAITING') {
        swLog('Client requested SKIP_WAITING. Activating new SW version.');
        self.skipWaiting();
    }
    // Example reply
    // event.ports[0].postMessage({ reply: 'Message received by SW!' });
});
