<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TB Registry</title>
  <link rel="stylesheet" href="/static/css/registry.css">
</head>
<body>
  <header class="header">
    <div class="container header-inner">
      <a href="/" class="logo">
        <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
          <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
          <line x1="12" y1="22.08" x2="12" y2="12"/>
        </svg>
        TB Registry
      </a>
      <div class="search-box">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" id="search" placeholder="Search packages..." autocomplete="off">
      </div>
      <nav class="nav">
        <a href="/">Browse</a>
        <a href="/docs">Docs</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>TB Registry</h1>
      <p>Package registry for the ToolBox Framework</p>
      <div class="stats" id="stats">
        <div class="stat"><span class="stat-value" id="pkg-count">-</span><span class="stat-label">Packages</span></div>
        <div class="stat"><span class="stat-value" id="dl-count">-</span><span class="stat-label">Downloads</span></div>
      </div>
    </section>

    <section class="section">
      <h2 class="section-title">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
        </svg>
        Packages
      </h2>
      <div id="packages" class="pkg-grid">
        <div class="loading"><div class="spinner"></div></div>
      </div>
    </section>

    <section class="section">
      <h2 class="section-title">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/>
        </svg>
        Artifacts
      </h2>
      <div id="artifacts" class="pkg-grid">
        <div class="pkg-card">
          <div class="pkg-header">
            <span class="pkg-name">SimpleCore Desktop</span>
            <span class="badge badge-success">Official</span>
          </div>
          <p class="pkg-desc">The official ToolBox desktop application with graphical interface.</p>
          <div class="pkg-meta">
            <span>ü™ü Windows</span>
            <span>üçé macOS</span>
            <span>üêß Linux</span>
          </div>
        </div>
        <div class="pkg-card">
          <div class="pkg-header">
            <span class="pkg-name">TB CLI</span>
            <span class="badge badge-success">Official</span>
          </div>
          <p class="pkg-desc">Command-line interface for ToolBox Framework.</p>
          <div class="pkg-meta">
            <span>üì¶ pip install toolboxv2</span>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      TB Registry &copy; 2025 &middot;
      <a href="https://simplecore.app">SimpleCore.app</a> &middot;
      <a href="https://github.com/MarkinHaus/ToolBoxV2">GitHub</a>
    </div>
  </footer>

  <script>
    const API = '/api/v1';

    async function fetchStats() {
      try {
        const res = await fetch(`${API}/packages`);
        const data = await res.json();
        document.getElementById('pkg-count').textContent = data.total || 0;
        document.getElementById('dl-count').textContent = '-';
      } catch { document.getElementById('pkg-count').textContent = '0'; }
    }

    async function fetchPackages(query = '') {
      const container = document.getElementById('packages');
      container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
      try {
        const url = query ? `${API}/packages?q=${encodeURIComponent(query)}` : `${API}/packages`;
        const res = await fetch(url);
        const data = await res.json();
        const pkgs = data.packages || [];
        if (!pkgs.length) {
          container.innerHTML = '<div class="empty"><div class="empty-icon">üì¶</div>No packages found</div>';
          return;
        }
        container.innerHTML = pkgs.map(p => `
          <a href="/package/${p.name}" class="pkg-card">
            <div class="pkg-header">
              <span class="pkg-name">${p.name}</span>
              <span class="pkg-version">v${p.latest_version || '0.0.0'}</span>
            </div>
            <p class="pkg-desc">${p.description || 'No description'}</p>
            <div class="pkg-meta">
              <span>üì• ${p.downloads || 0}</span>
              <span>üìÖ ${p.updated_at ? new Date(p.updated_at).toLocaleDateString() : '-'}</span>
            </div>
          </a>
        `).join('');
      } catch (e) {
        container.innerHTML = '<div class="empty"><div class="empty-icon">‚ö†Ô∏è</div>Failed to load packages</div>';
      }
    }

    let debounce;
    document.getElementById('search').addEventListener('input', e => {
      clearTimeout(debounce);
      debounce = setTimeout(() => fetchPackages(e.target.value), 300);
    });

    fetchStats();
    fetchPackages();
  </script>
</body>
</html>

