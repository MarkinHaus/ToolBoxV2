
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://MarkinHaus.github.io/ToolBoxV2/utils/">
      
      
        <link rel="prev" href="../toolboxv2/">
      
      
        <link rel="next" href="../isaa/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>utils - ToolBoxV2 Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#toolboxv2-the-app-class" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ToolBoxV2 Docs" class="md-header__button md-logo" aria-label="ToolBoxV2 Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ToolBoxV2 Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              utils
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/MarkinHaus/ToolBoxV2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ToolBoxV2
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ToolBoxV2 Docs" class="md-nav__button md-logo" aria-label="ToolBoxV2 Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ToolBoxV2 Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MarkinHaus/ToolBoxV2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ToolBoxV2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../module_creation_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tbjs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TBjs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../clis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLIS
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/MarkinHaus/ToolBoxV2/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Report Issues
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../toolboxv2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    toolboxv2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-initialization-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Key Initialization Steps:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-functionalities" class="md-nav__link">
    <span class="md-ellipsis">
      Core Functionalities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Functionalities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-management" class="md-nav__link">
    <span class="md-ellipsis">
      Module Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-registration-and-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Function Registration and Execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      Application Lifecycle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Utilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-management-appsession" class="md-nav__link">
    <span class="md-ellipsis">
      Session Management (app.session)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-cli-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Key CLI Arguments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-execution-flow-__main__py" class="md-nav__link">
    <span class="md-ellipsis">
      CLI Execution Flow (__main__.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-cli-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example CLI Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example CLI Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#export-decorator-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      @export Decorator Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#result-and-apiresult-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Result and ApiResult Objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestdata-object" class="md-nav__link">
    <span class="md-ellipsis">
      RequestData Object
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-maintool-based-module" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a MainTool-based Module
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps-to-create-a-valid-toolboxv2-module" class="md-nav__link">
    <span class="md-ellipsis">
      Steps to Create a Valid Toolboxv2 Module:
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../isaa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    isaa
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    isaa_help
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    etc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            etc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../account_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    account_management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    changelog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../db_usage_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    db_usage_guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../p2p_rpc_protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    p2p_rpc_protocol
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    stack
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-initialization-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Key Initialization Steps:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-functionalities" class="md-nav__link">
    <span class="md-ellipsis">
      Core Functionalities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Functionalities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-management" class="md-nav__link">
    <span class="md-ellipsis">
      Module Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-registration-and-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Function Registration and Execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      Application Lifecycle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Utilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-management-appsession" class="md-nav__link">
    <span class="md-ellipsis">
      Session Management (app.session)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-cli-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Key CLI Arguments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-execution-flow-__main__py" class="md-nav__link">
    <span class="md-ellipsis">
      CLI Execution Flow (__main__.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-cli-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example CLI Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example CLI Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#export-decorator-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      @export Decorator Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#result-and-apiresult-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Result and ApiResult Objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestdata-object" class="md-nav__link">
    <span class="md-ellipsis">
      RequestData Object
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-maintool-based-module" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a MainTool-based Module
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps-to-create-a-valid-toolboxv2-module" class="md-nav__link">
    <span class="md-ellipsis">
      Steps to Create a Valid Toolboxv2 Module:
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  


  
  


<h1 id="toolboxv2-the-app-class">ToolBoxV2: The <code>App</code> Class<a class="headerlink" href="#toolboxv2-the-app-class" title="Permanent link">&para;</a></h1>
<p>The <code>App</code> class is the central singleton instance in ToolBoxV2, responsible for managing the application's lifecycle, configuration, module loading, and core functionalities. It's typically accessed via the <code>get_app()</code> utility function.</p>
<h2 id="initialization">Initialization<a class="headerlink" href="#initialization" title="Permanent link">&para;</a></h2>
<p>The <code>App</code> instance is initialized with a <code>prefix</code> and <code>AppArgs</code> (command-line arguments).</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">toolboxv2</span><span class="w"> </span><span class="kn">import</span> <span class="n">App</span><span class="p">,</span> <span class="n">AppArgs</span><span class="p">,</span> <span class="n">get_app</span>

<span class="c1"># Example: Initialize or get the App instance</span>
<span class="c1"># The prefix helps differentiate multiple App instances if needed,</span>
<span class="c1"># and is often used in directory naming.</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">AppArgs</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">()</span> <span class="c1"># Or parsed from sys.argv in __main__.py</span>
<span class="n">app_instance</span> <span class="o">=</span> <span class="n">get_app</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;my_app_instance&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>

<span class="c1"># Accessing key attributes:</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;App ID: </span><span class="si">{</span><span class="n">app_instance</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Version: </span><span class="si">{</span><span class="n">app_instance</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start Directory: </span><span class="si">{</span><span class="n">app_instance</span><span class="o">.</span><span class="n">start_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Directory: </span><span class="si">{</span><span class="n">app_instance</span><span class="o">.</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config Directory: </span><span class="si">{</span><span class="n">app_instance</span><span class="o">.</span><span class="n">config_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Debug Mode: </span><span class="si">{</span><span class="n">app_instance</span><span class="o">.</span><span class="n">debug</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="key-initialization-steps">Key Initialization Steps:<a class="headerlink" href="#key-initialization-steps" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>System &amp; Paths:</strong></p>
<ul>
<li>Determines the operating system (<code>system_flag</code>).</li>
<li>Sets the <code>start_dir</code> to the application's root directory.</li>
<li>Resolves the <code>prefix</code>:<ul>
<li>If no prefix is provided, it attempts to load the last used prefix from <code>.data/last-app-prefix.txt</code>.</li>
<li>If a prefix is provided, it's saved to this file for future use.</li>
</ul>
</li>
<li>Constructs the <code>app_id</code> (e.g., <code>prefix-hostname</code>).</li>
<li>Sets up <code>data_dir</code>, <code>config_dir</code>, and <code>info_dir</code> based on the <code>app_id</code> (e.g., <code>./.data/prefix-hostname/</code>).</li>
<li>Sets up <code>appdata</code> directory (OS-specific application data folder).</li>
</ul>
</li>
<li>
<p><strong>Logging:</strong></p>
<ul>
<li>Initializes a logger (<code>app.logger</code>). The logging level and output (terminal/file) can vary based on the <code>prefix</code> (e.g., "test", "live", "debug") and the <code>--debug</code> CLI argument.</li>
</ul>
</li>
<li>
<p><strong>Configuration:</strong></p>
<ul>
<li>Loads application configuration using <code>FileHandler</code> from a file typically named <code>app_id.config</code> in the <code>config_dir</code>.</li>
<li>Defines default configuration <code>keys</code> and <code>defaults</code> (e.g., for macros, helpers, debug status).</li>
</ul>
</li>
<li>
<p><strong>Core Attributes:</strong></p>
<ul>
<li><code>version</code>: ToolBoxV2 version, read from <code>pyproject.toml</code>.</li>
<li><code>debug</code>: Boolean, controlled by CLI args and config.</li>
<li><code>dev_modi</code>: Boolean, development mode status from config.</li>
<li><code>functions</code>: A dictionary to store registered functions from modules.</li>
<li><code>modules</code>: A dictionary to store loaded module objects.</li>
<li><code>interface_type</code>: Default <code>ToolBoxInterfaces.native</code>.</li>
<li><code>alive</code>: Boolean, controls the main application loop.</li>
<li><code>args_sto</code>: Stores the parsed <code>AppArgs</code>.</li>
<li><code>loop</code>: The asyncio event loop (initialized later or if already running).</li>
<li><code>session</code>: A <code>Session</code> object for managing user/remote session state.</li>
</ul>
</li>
<li>
<p><strong>Conditional Actions (based on <code>AppArgs</code>):</strong></p>
<ul>
<li><code>args.init</code>: If true, adds <code>start_dir</code> to <code>sys.path</code>.</li>
<li>The <code>__main__.py</code> script handles other arguments like <code>--update</code>, <code>--get-version</code>, etc., by calling <code>App</code> methods or other utilities.</li>
</ul>
</li>
</ol>
<h2 id="core-functionalities">Core Functionalities<a class="headerlink" href="#core-functionalities" title="Permanent link">&para;</a></h2>
<h3 id="module-management">Module Management<a class="headerlink" href="#module-management" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong><code>load_mod(mod_name: str, spec='app', mlm='I', **kwargs)</code> / <code>save_load(modname, spec='app')</code>:</strong></p>
<ul>
<li>Loads a module into the application.</li>
<li><code>spec</code> (specification): Used to namespace or categorize the module instance (e.g., 'app' for general, or a specific session ID).</li>
<li>Supports different loading mechanisms (<code>mlm</code>):<ul>
<li><code>'I'</code>: In-place load (imports the Python module directly). This is the default.</li>
<li><code>'C'</code>: Copies the module file to a runtime directory before loading (less common).</li>
</ul>
</li>
<li>Handles <code>ModuleNotFoundError</code> by attempting to guide the user (e.g., install via <code>CloudM</code> or <code>pip</code>).</li>
<li>Registers the module's exported functions and/or its <code>Tools</code> class instance.</li>
<li>Can reload modules if they are already loaded.
<div class="highlight"><pre><span></span><code><span class="c1"># Load the &#39;MyModule&#39;</span>
<span class="n">my_module_instance</span> <span class="o">=</span> <span class="n">app_instance</span><span class="o">.</span><span class="n">load_mod</span><span class="p">(</span><span class="s2">&quot;MyModule&quot;</span><span class="p">)</span>

<span class="c1"># Or if it&#39;s a Tool-based module:</span>
<span class="c1"># my_tool_instance = app_instance.load_mod(&quot;MyToolModule&quot;)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong><code>get_mod(name: str, spec='app') -&gt; ModuleType | MainToolType</code>:</strong></p>
<ul>
<li>Retrieves a loaded module instance. If the module isn't loaded, it attempts to load it.
<div class="highlight"><pre><span></span><code><span class="n">db_mod</span> <span class="o">=</span> <span class="n">app_instance</span><span class="o">.</span><span class="n">get_mod</span><span class="p">(</span><span class="s2">&quot;DB&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">db_mod</span><span class="p">:</span>
    <span class="n">db_mod</span><span class="o">.</span><span class="n">some_db_function</span><span class="p">()</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong><code>remove_mod(mod_name: str, spec='app', delete=True)</code> / <code>a_remove_mod(...)</code> (async):</strong></p>
<ul>
<li>Unloads a module, calling its <code>on_exit</code> functions if defined.</li>
<li><code>delete=True</code> removes it completely from the <code>functions</code> registry.</li>
</ul>
</li>
<li>
<p><strong><code>reload_mod(mod_name: str, spec='app', ...)</code>:</strong></p>
<ul>
<li>Reloads an existing module. Useful for development.</li>
</ul>
</li>
<li>
<p><strong><code>watch_mod(mod_name: str, ...)</code>:</strong></p>
<ul>
<li>Monitors a module's source file(s) for changes and automatically reloads it.
<div class="highlight"><pre><span></span><code><span class="c1"># In development, watch &#39;MyDevModule&#39; for changes</span>
<span class="n">app_instance</span><span class="o">.</span><span class="n">watch_mod</span><span class="p">(</span><span class="s2">&quot;MyDevModule&quot;</span><span class="p">)</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong><code>load_all_mods_in_file(working_dir="mods")</code> / <code>a_load_all_mods_in_file(...)</code> (async):</strong></p>
<ul>
<li>Scans the specified directory (default <code>./mods/</code>) and loads all valid Python modules found.</li>
</ul>
</li>
</ul>
<h3 id="function-registration-and-execution">Function Registration and Execution<a class="headerlink" href="#function-registration-and-execution" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong><code>@app.tb(...)</code> Decorator (via <code>_create_decorator</code>):</strong></p>
<ul>
<li>The primary way functions are registered with ToolBoxV2. See <code>example_mod.md</code> for details on usage.</li>
<li>This decorator populates the <code>app.functions</code> dictionary.</li>
</ul>
</li>
<li>
<p><strong><code>get_function(name: Enum | tuple, metadata=False, state=True, specification='app', ...)</code>:</strong></p>
<ul>
<li>Retrieves a registered function.</li>
<li><code>name</code>: Can be an Enum (from <code>all_functions_enums.py</code>) or a <code>(module_name, function_name)</code> tuple.</li>
<li><code>metadata=True</code>: Returns a tuple <code>(function_data_dict, callable_function)</code>.</li>
<li><code>state=True</code>: Returns a stateful version of the function (bound to its module instance if applicable).</li>
<li><code>state=False</code>: Returns the raw, stateless function.</li>
<li><code>specification</code>: The context/instance spec to get the function for.</li>
</ul>
</li>
<li>
<p><strong><code>run_any(mod_function_name, ..., get_results=False, **kwargs)</code> / <code>a_run_any(...)</code> (async):</strong></p>
<ul>
<li>Executes a registered function by its name (Enum or tuple).</li>
<li>Handles argument passing, stateful/stateless execution, and error wrapping into a <code>Result</code> object.</li>
<li><code>get_results=True</code>: Returns the <code>Result</code> object itself.</li>
<li><code>get_results=False</code> (default): Returns the <code>data</code> payload from the <code>Result</code> object if successful.</li>
<li>Automatically handles running the function's pre/post compute hooks and caching if configured via <code>@app.tb</code>.
<div class="highlight"><pre><span></span><code><span class="c1"># Synchronous execution</span>
<span class="n">result_data</span> <span class="o">=</span> <span class="n">app_instance</span><span class="o">.</span><span class="n">run_any</span><span class="p">((</span><span class="s2">&quot;MyModule&quot;</span><span class="p">,</span> <span class="s2">&quot;my_function&quot;</span><span class="p">),</span> <span class="n">arg1</span><span class="o">=</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<span class="n">full_result_obj</span> <span class="o">=</span> <span class="n">app_instance</span><span class="o">.</span><span class="n">run_any</span><span class="p">((</span><span class="s2">&quot;MyModule&quot;</span><span class="p">,</span> <span class="s2">&quot;my_function&quot;</span><span class="p">),</span> <span class="n">arg1</span><span class="o">=</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="n">get_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Asynchronous execution</span>
<span class="n">async_result_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app_instance</span><span class="o">.</span><span class="n">a_run_any</span><span class="p">((</span><span class="s2">&quot;MyAsyncModule&quot;</span><span class="p">,</span> <span class="s2">&quot;my_async_function&quot;</span><span class="p">))</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong><code>run_http(mod_function_name, function_name=None, method="GET", ...)</code> (async):</strong></p>
<ul>
<li>Executes a function on a remote ToolBoxV2 instance via HTTP, using the app's <code>session</code> object.</li>
</ul>
</li>
</ul>
<h3 id="application-lifecycle">Application Lifecycle<a class="headerlink" href="#application-lifecycle" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>exit()</code> / <code>a_exit()</code> (async):</strong><ul>
<li>Gracefully shuts down the application.</li>
<li>Calls <code>on_exit</code> functions for all loaded modules.</li>
<li>Saves configuration.</li>
<li>Stops the main application loop (<code>alive = False</code>).</li>
<li>Cleans up threads and the event loop if applicable.</li>
</ul>
</li>
</ul>
<h3 id="utilities">Utilities<a class="headerlink" href="#utilities" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>print(text, *args, **kwargs)</code> / <code>sprint(text, *args, **kwargs)</code>:</strong><ul>
<li>Styled print functions, prepending <code>System$[app_id]:</code>. <code>sprint</code> is often used for more verbose/system-level messages and can be silenced.</li>
</ul>
</li>
<li><strong><code>debug_rains(e: Exception)</code>:</strong> If <code>app.debug</code> is true, prints a full traceback and re-raises the exception.</li>
<li><strong><code>set_flows(r: dict)</code> / <code>run_flows(name: str, **kwargs)</code>:</strong> Manages and executes predefined application flows (sequences of operations).</li>
<li><strong><code>get_username()</code> / <code>set_username(username: str)</code>:</strong> Manages the application's user identity.</li>
<li><strong><code>save_autocompletion_dict()</code> / <code>get_autocompletion_dict()</code>:</strong> Saves/loads a dictionary of modules and their functions for autocompletion features.</li>
<li><strong><code>save_registry_as_enums(directory: str, filename: str)</code>:</strong> Generates an <code>all_functions_enums.py</code>-like file from the currently registered functions.</li>
<li><strong><code>execute_all_functions(...)</code> / <code>a_execute_all_functions(...)</code> (async):</strong><ul>
<li>Runs all registered testable functions (marked with <code>test=True</code> in <code>@app.tb</code> or having <code>samples</code>).</li>
<li>Useful for integration testing and profiling.</li>
<li>Can filter by module (<code>m_query</code>) and function (<code>f_query</code>).</li>
<li>Supports profiling via <code>cProfile</code>.</li>
</ul>
</li>
<li><strong><code>run_bg_task(task: Callable)</code>:</strong><ul>
<li>Runs a synchronous or asynchronous task in a separate background thread with its own event loop. Ensures proper handling of nested asyncio operations within the task.</li>
</ul>
</li>
</ul>
<h2 id="session-management-appsession">Session Management (<code>app.session</code>)<a class="headerlink" href="#session-management-appsession" title="Permanent link">&para;</a></h2>
<p>The <code>app.session</code> attribute holds an instance of the <code>Session</code> class (from <code>toolboxv2.utils.system.session</code>). It's used for:
*   Authenticating with a remote ToolBoxV2 service (e.g., SimpleCore Hub).
*   Making authenticated HTTP requests (<code>session.fetch</code>, <code>session.upload_file</code>, <code>session.download_file</code>).
*   Manages JWT claims and private key authentication.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example: Making an authenticated API call</span>
<span class="c1"># Assumes app.session is already authenticated</span>
<span class="n">response_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app_instance</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;/api/MyRemoteModule/get_info&quot;</span><span class="p">)</span>
<span class="n">json_payload</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response_data</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div>
<hr />
<div class="highlight"><pre><span></span><code>### 2. `cli.md` - Documenting the Command Line Interface

This should explain how to use the `tb` (or `python -m tb`) command-line tool, detailing its arguments and their effects.

```markdown
# ToolBoxV2: Command Line Interface (CLI)

ToolBoxV2 provides a command-line interface (CLI) for managing and running applications. It&#39;s typically invoked as `tb` (if installed globally or via an alias) or `python -m tb`.

## General Usage

```bash
python -m tb [options] [sub-commands]
# or
tb [options] [sub-commands]
</code></pre></div>
<p>The CLI script (<code>__main__.py</code>) performs the following main steps:
1.  Parses command-line arguments.
2.  Initializes the <code>App</code> instance via <code>setup_app()</code> (which calls <code>get_app()</code>).
3.  Handles various options to:
    *   Manage application data and configuration.
    *   Control application modes (background, proxy, debug).
    *   Load modules and manage their state.
    *   Run tests or profilers.
    *   Execute specific application flows or commands.</p>
<h2 id="key-cli-arguments">Key CLI Arguments<a class="headerlink" href="#key-cli-arguments" title="Permanent link">&para;</a></h2>
<p>The following are some of the primary arguments available. Use <code>tb -h</code> or <code>python -m tb -h</code> for a full list.</p>
<ul>
<li>
<p><strong>Instance and Mode:</strong></p>
<ul>
<li><code>-init [name]</code>: Initializes ToolBoxV2 with a specific instance name (default: <code>main</code>).</li>
<li><code>-n, --name &lt;name&gt;</code>: Specifies an ID for the ToolBox instance (default: <code>main</code>). This affects data/config directory names.</li>
<li><code>-m, --modi &lt;mode&gt;</code>: Starts a ToolBoxV2 interface/flow (e.g., <code>cli</code>, <code>bg</code>, or custom flows). Default is usually "cli".</li>
<li><code>--debug</code>: Starts the application in debug mode (more verbose logging, potentially different behavior).</li>
<li><code>--remote</code>: Starts in remote mode, often for connecting to a proxy or another instance.</li>
<li><code>-bg, --background-application</code>: Starts an interface in the background as a detached process.</li>
<li><code>-bgr, --background-application-runner</code>: Runs the background application logic in the current terminal (for daemons).</li>
<li><code>-fg, --live-application</code>: Starts a proxy interface, connecting to a background daemon.</li>
<li><code>--kill</code>: Kills the currently running local ToolBoxV2 instance (matching the <code>-m &lt;mode&gt;</code> and <code>-n &lt;name&gt;</code>).</li>
</ul>
</li>
<li>
<p><strong>Module and Version Management:</strong></p>
<ul>
<li><code>-l, --load-all-mod-in-files</code>: Loads all modules found in the <code>mods/</code> directory on startup.</li>
<li><code>-sfe, --save-function-enums-in-file</code>: Generates/updates the <code>all_functions_enums.py</code> file based on loaded modules. Often used with <code>-l</code>.</li>
<li><code>-v, --get-version</code>: Prints the version of ToolBoxV2 and all loaded modules.</li>
<li><code>-i, --install &lt;name&gt;</code>: Installs a module or interface (likely via <code>CloudM</code> module).</li>
<li><code>-r, --remove &lt;name&gt;</code>: Uninstalls a module or interface.</li>
<li><code>-u, --update &lt;name_or_main&gt;</code>: Updates a module/interface or the core ToolBoxV2 (<code>main</code>).</li>
</ul>
</li>
<li>
<p><strong>Development and Testing:</strong></p>
<ul>
<li><code>--test</code>: Runs all unit tests (typically discovers and runs tests in the <code>tests/</code> directory).</li>
<li><code>--profiler</code>: Runs all registered testable functions and profiles their execution using <code>cProfile</code>.</li>
<li><code>--ipy</code>: Starts an IPython session with the ToolBoxV2 app pre-loaded. Provides magic commands like <code>%tb save/loadX/load/open/inject</code>.</li>
</ul>
</li>
<li>
<p><strong>Service Management (<code>--sm</code>):</strong></p>
<ul>
<li>Provides a sub-menu for managing ToolBoxV2 as a system service (Linux/systemd or Windows Startup).</li>
<li>Options: Init, Start/Stop/Restart, Status, Uninstall, Show/Hide console window (Windows).</li>
</ul>
</li>
<li>
<p><strong>Log Management (<code>--lm</code>):</strong></p>
<ul>
<li>Provides a sub-menu for managing log files (e.g., removing or unstyling logs by date/level).</li>
</ul>
</li>
<li>
<p><strong>Data and Configuration Management:</strong></p>
<ul>
<li><code>--delete-config-all</code>: Deletes <em>all</em> configuration files. <strong>Use with caution!</strong></li>
<li><code>--delete-data-all</code>: Deletes <em>all</em> data folders. <strong>Use with caution!</strong></li>
<li><code>--delete-config</code>: Deletes the configuration file for the <em>named</em> instance.</li>
<li><code>--delete-data</code>: Deletes the data folder for the <em>named</em> instance.</li>
</ul>
</li>
<li>
<p><strong>Network Configuration (for interfaces):</strong></p>
<ul>
<li><code>-p, --port &lt;port&gt;</code>: Specifies the port for an interface (default: <code>5000</code> or <code>6587</code> for background).</li>
<li><code>-w, --host &lt;host&gt;</code>: Specifies the host for an interface (default: <code>0.0.0.0</code>).</li>
</ul>
</li>
<li>
<p><strong>Direct Command Execution:</strong></p>
<ul>
<li><code>-c, --command &lt;module_name&gt; &lt;function_name&gt; [arg1 arg2 ...]</code> (can be repeated): Executes a specific function.</li>
<li><code>--kwargs &lt;key=value&gt;</code> (can be repeated): Provides keyword arguments for commands specified with <code>-c</code>.</li>
</ul>
</li>
<li>
<p><strong>Conda Integration:</strong></p>
<ul>
<li><code>conda [conda_args...]</code>: Special argument to pass commands directly to a <code>conda_runner.py</code> script (e.g., <code>tb conda env list</code>).</li>
</ul>
</li>
<li>
<p><strong>API Runner:</strong></p>
<ul>
<li><code>api [api_args...]</code>: Special argument to invoke <code>cli_api_runner.py</code>, likely for direct API interactions or testing.</li>
</ul>
</li>
<li>
<p><strong>GUI:</strong></p>
<ul>
<li><code>gui</code>: Starts the GUI version of ToolBoxV2 (imports and runs <code>toolboxv2.__gui__.start</code>).</li>
</ul>
</li>
</ul>
<h2 id="cli-execution-flow-__main__py">CLI Execution Flow (<code>__main__.py</code>)<a class="headerlink" href="#cli-execution-flow-__main__py" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Argument Parsing:</strong> <code>parse_args()</code> uses <code>argparse</code> to define and parse all CLI arguments.</li>
<li><strong>App Setup (<code>setup_app()</code>):</strong><ul>
<li>Initializes the <code>App</code> instance using <code>get_app()</code> with the parsed arguments and name.</li>
<li>Sets up PID file for the current process.</li>
<li>Optionally silences <code>app.sprint</code> if not in debug/verbose mode.</li>
<li>Loads all modules if <code>-l</code> is specified.</li>
<li>Handles <code>--update</code> logic.</li>
</ul>
</li>
<li><strong>Background/Live Application Handling:</strong><ul>
<li>If <code>-bgr</code>: Initializes <code>DaemonApp</code>.</li>
<li>If <code>-bg</code>: Starts the application as a detached background process using <code>subprocess.Popen</code>.</li>
<li>If <code>-fg</code> (live-application): Attempts to connect to a background daemon using <code>ProxyApp</code>.</li>
</ul>
</li>
<li><strong>Action Dispatching:</strong> Based on the parsed arguments, it performs actions like:<ul>
<li>Module installation (<code>--install</code>).</li>
<li>Log management (<code>--lm</code>).</li>
<li>Service management (<code>--sm</code>).</li>
<li>Saving function enums (<code>-sfe</code>).</li>
<li>Printing versions (<code>-v</code>).</li>
<li>Running the profiler (<code>--profiler</code>).</li>
<li>Running flows based on <code>--modi</code>.</li>
<li>Handling Docker commands (<code>--docker</code>).</li>
<li>Killing an existing instance (<code>--kill</code>).</li>
<li>Executing direct commands (<code>-c</code>).</li>
</ul>
</li>
<li><strong>Cleanup:</strong> Removes the PID file and calls <code>app.a_exit()</code> before exiting.</li>
</ol>
<h2 id="example-cli-usage">Example CLI Usage<a class="headerlink" href="#example-cli-usage" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Get version information</span>
python<span class="w"> </span>-m<span class="w"> </span>tb<span class="w"> </span>-v

<span class="c1"># Load all modules and save function enums</span>
python<span class="w"> </span>-m<span class="w"> </span>tb<span class="w"> </span>-l<span class="w"> </span>-sfe

<span class="c1"># Run a specific function in MyModule</span>
python<span class="w"> </span>-m<span class="w"> </span>tb<span class="w"> </span>-c<span class="w"> </span>MyModule<span class="w"> </span>my_function<span class="w"> </span>arg_value<span class="w"> </span>--kwargs<span class="w"> </span><span class="nv">param_name</span><span class="o">=</span>kwarg_value

<span class="c1"># Start the application with a custom flow named &#39;web_server&#39; in debug mode</span>
python<span class="w"> </span>-m<span class="w"> </span>tb<span class="w"> </span>-m<span class="w"> </span>web_server<span class="w"> </span>--debug<span class="w"> </span>-n<span class="w"> </span>my_web_instance

<span class="c1"># Start a background daemon for the &#39;bg_processing&#39; flow</span>
python<span class="w"> </span>-m<span class="w"> </span>tb<span class="w"> </span>-m<span class="w"> </span>bg_processing<span class="w"> </span>-bg<span class="w"> </span>-n<span class="w"> </span>background_processor

<span class="c1"># Connect to the background daemon with a live proxy application</span>
python<span class="w"> </span>-m<span class="w"> </span>tb<span class="w"> </span>-m<span class="w"> </span>cli<span class="w"> </span>-fg<span class="w"> </span>-n<span class="w"> </span>background_processor

<span class="c1"># Kill the &#39;web_server&#39; modi instance named &#39;my_web_instance&#39;</span>
python<span class="w"> </span>-m<span class="w"> </span>tb<span class="w"> </span>-m<span class="w"> </span>web_server<span class="w"> </span>--kill<span class="w"> </span>-n<span class="w"> </span>my_web_instance
</code></pre></div>
<hr />
<div class="highlight"><pre><span></span><code>### 3. `example_mod.md` - Documenting Module Creation

This needs to be updated to accurately reflect the `@app.tb(...)` decorator from `toolbox.py` and the `Result` and `RequestData` classes from `types.py`.

```markdown
# ToolBoxV2: Creating Modules

ToolBoxV2 modules are Python files or packages that extend the framework&#39;s functionality. They can define simple functions, stateful tools (classes inheriting from `MainTool`), or API endpoints.

## Basic Module Structure

A typical ToolBoxV2 module (`.py` file) includes:

1.  **Imports:** Necessary libraries and ToolBoxV2 components.
2.  **Module Metadata (Optional but Recommended):**
    *   `Name` (or `name`): A string defining the module&#39;s canonical name.
    *   `version`: A string for the module&#39;s version (e.g., &quot;1.0.0&quot;).
3.  **Function/Class Definitions:** The core logic of your module.
4.  **Exporting Functions:** Functions are made available to ToolBoxV2 using the `@export` decorator (which is an alias for `app.tb`).

## The `@export` Decorator (`app.tb`)

The `@export` decorator is the primary mechanism for registering functions and configuring their behavior within ToolBoxV2. It&#39;s obtained from an `App` instance.

```python
from toolboxv2 import get_app, App, Result, RequestData, MainTool
from toolboxv2.utils.system.types import ToolBoxInterfaces # For specific interface types
from typing import Optional, Dict, Any, List
import asyncio

# Get the application instance (singleton)
# The &#39;prefix&#39; for get_app here is often the module&#39;s own name,
# though the decorator will use its &#39;mod_name&#39; parameter.
app = get_app(&quot;MyModule&quot;)
export = app.tb # Alias the decorator for convenience

# --- Module Metadata (Best Practice) ---
Name = &quot;MyModule&quot;  # Used by the decorator if mod_name is not specified
version = &quot;1.0.1&quot;

# --- Example Functions ---

@export(mod_name=Name, version=version, helper=&quot;A simple greeting function.&quot;)
def greet(name: str) -&gt; str:
    &quot;&quot;&quot;Returns a greeting message.&quot;&quot;&quot;
    return f&quot;Hello, {name} from MyModule!&quot;

@export(mod_name=Name, version=version, row=True, helper=&quot;Returns raw data without Result wrapping.&quot;)
def get_raw_data() -&gt; dict:
    &quot;&quot;&quot;Demonstrates returning raw data.&quot;&quot;&quot;
    return {&quot;key&quot;: &quot;value&quot;, &quot;number&quot;: 123}

@export(mod_name=Name, version=version, initial=True, helper=&quot;Runs when the module is first loaded.&quot;)
def on_module_load():
    &quot;&quot;&quot;Initialization logic for this module.&quot;&quot;&quot;
    app.print(f&quot;{Name} module has been loaded and initialized!&quot;)
    # return Result.ok(info=&quot;MyModule initialized successfully&quot;) # Optional: return a Result

@export(mod_name=Name, version=version, exit_f=True, helper=&quot;Runs when the application is shutting down.&quot;)
async def on_module_exit():
    &quot;&quot;&quot;Cleanup logic for this module.&quot;&quot;&quot;
    await asyncio.sleep(0.1) # Simulate async cleanup
    app.print(f&quot;{Name} module is cleaning up.&quot;)
    # return Result.ok(info=&quot;MyModule cleaned up.&quot;) # Optional

@export(mod_name=Name, version=version, api=True, api_methods=[&#39;GET&#39;], request_as_kwarg=True,
        helper=&quot;An example API endpoint.&quot;)
async def my_api_endpoint(request: Optional[RequestData] = None) -&gt; Result:
    &quot;&quot;&quot;
    Handles GET requests to /api/MyModule/my_api_endpoint.
    Accesses request details if provided.
    &quot;&quot;&quot;
    if request:
        app.print(f&quot;API request received: {request.request.method} {request.request.path}&quot;)
        app.print(f&quot;Query Params: {request.request.query_params}&quot;)
        app.print(f&quot;User from session: {request.session.user_name}&quot;)
    return Result.json(data={&quot;message&quot;: &quot;API call successful!&quot;, &quot;module_version&quot;: version})

@export(mod_name=Name, version=version, memory_cache=True, memory_cache_ttl=60)
def expensive_calculation(param: int) -&gt; int:
    &quot;&quot;&quot;
    An example of a function whose results will be cached in memory for 60 seconds.
    &quot;&quot;&quot;
    app.print(f&quot;Performing expensive calculation for {param}...&quot;)
    time.sleep(2) # Simulate work
    return param * param

# Example of a more complex function using App instance and returning a Result
@export(mod_name=Name, version=version)
def process_data_with_app(app_instance: App, data_id: int) -&gt; Result:
    &quot;&quot;&quot;
    This function automatically receives the &#39;App&#39; instance if its first parameter is type-hinted as &#39;App&#39;.
    This is determined by the &#39;state=True&#39; logic in the decorator if &#39;app&#39; is the first param.
    Alternatively, use state=False for stateless functions.
    &quot;&quot;&quot;
    if not isinstance(app_instance, App): # Should always be App if first param is &#39;app&#39;
        return Result.default_internal_error(&quot;App instance not correctly passed.&quot;)

    # Use app_instance for logging, accessing config, other modules, etc.
    app_instance.logger.info(f&quot;Processing data_id: {data_id} in {Name}&quot;)
    if data_id &lt; 0:
        return Result.default_user_error(info=&quot;Data ID cannot be negative.&quot;)
    return Result.ok(data={&quot;processed_id&quot;: data_id, &quot;status&quot;: &quot;completed&quot;})
</code></pre></div>
<h3 id="export-decorator-parameters"><code>@export</code> Decorator Parameters:<a class="headerlink" href="#export-decorator-parameters" title="Permanent link">&para;</a></h3>
<ul>
<li><code>name</code> (str, optional): The name to register the function under. Defaults to the function's actual name.</li>
<li><code>mod_name</code> (str): The name of the module this function belongs to. If not provided, it tries to infer from <code>func.__module__</code> or a global <code>Name</code> in the module.</li>
<li><code>version</code> (str, optional): Version string for this function/feature. Combined with the app's version.</li>
<li><code>helper</code> (str, optional): A docstring or help text for the function.</li>
<li><code>api</code> (bool, default <code>False</code>): If <code>True</code>, exposes this function as an HTTP API endpoint.<ul>
<li>The URL pattern is typically <code>/api/&lt;mod_name&gt;/&lt;func_name&gt;</code>.</li>
<li>For streaming, <code>/sse/&lt;mod_name&gt;/&lt;func_name&gt;</code>.</li>
</ul>
</li>
<li><code>api_methods</code> (List[str], optional): Specifies allowed HTTP methods (e.g., <code>['GET', 'POST']</code>). Defaults to <code>['AUTO']</code> (GET if no body params, POST if body params).</li>
<li><code>request_as_kwarg</code> (bool, default <code>False</code>): If <code>True</code> and <code>api=True</code>, the function will receive a <code>request: RequestData</code> keyword argument if it's defined in its signature.</li>
<li><code>row</code> (bool, default <code>False</code>): If <code>True</code>, the function's raw return value is used directly. If <code>False</code> (default), the return value is automatically wrapped in a <code>Result.ok()</code> object if it's not already a <code>Result</code> or <code>ApiResult</code>.</li>
<li><code>initial</code> (bool, default <code>False</code>): If <code>True</code>, this function is added to the module's "on_start" list and is called when the module is loaded by the <code>App</code> instance (if the module instance is a <code>MainTool</code> or similar, or if called directly).</li>
<li><code>exit_f</code> (bool, default <code>False</code>): If <code>True</code>, this function is added to the module's "on_exit" list and is called when the <code>App</code> instance is shutting down or the module is removed.</li>
<li><code>state</code> (bool, optional):<ul>
<li>If <code>None</code> (default): Automatically determined. If the first parameter of the decorated function is named <code>self</code> or <code>app</code> (and type-hinted as <code>App</code>), <code>state</code> is considered <code>True</code>. Otherwise <code>False</code>.</li>
<li>If <code>True</code>: The function is considered stateful. If its first parameter is <code>self</code>, it's assumed to be a method of a class instance (e.g., a <code>MainTool</code> subclass). If <code>app</code>, the <code>App</code> instance is passed.</li>
<li>If <code>False</code>: The function is treated as stateless.</li>
</ul>
</li>
<li><code>test</code> (bool, default <code>True</code>): Marks the function as testable. Used by <code>app.execute_all_functions()</code>.</li>
<li><code>samples</code> (List[Dict[str, Any]], optional): A list of sample keyword arguments to be used when testing the function with <code>app.execute_all_functions()</code>.</li>
<li><code>memory_cache</code> (bool, default <code>False</code>): Enables in-memory caching for the function's results.</li>
<li><code>memory_cache_ttl</code> (int, default <code>300</code>): Time-to-live in seconds for memory cache entries.</li>
<li><code>memory_cache_max_size</code> (int, default <code>100</code>): Max number of entries in the memory cache.</li>
<li><code>file_cache</code> (bool, default <code>False</code>): Enables file-based caching for the function's results. (Stored in <code>app.data_dir/cache/...</code>).</li>
<li><code>restrict_in_virtual_mode</code> (bool, default <code>False</code>): If <code>True</code>, restricts function in certain virtualized/proxied modes.</li>
<li><code>level</code> (int, default <code>-1</code>): A general-purpose level or priority for the function.</li>
<li><code>pre_compute</code> (Callable, optional): A function <code>(func, *args, **kwargs) -&gt; (args, kwargs)</code> called before the main function executes. It can modify args/kwargs.</li>
<li><code>post_compute</code> (Callable, optional): A function <code>(result, func, *args, **kwargs) -&gt; result</code> called after the main function executes. It can modify the result.</li>
<li><code>interface</code> (ToolBoxInterfaces | str, optional): Specifies the intended interface type (e.g., <code>ToolBoxInterfaces.cli</code>, <code>ToolBoxInterfaces.api</code>). Defaults to "tb".</li>
</ul>
<h3 id="result-and-apiresult-objects"><code>Result</code> and <code>ApiResult</code> Objects<a class="headerlink" href="#result-and-apiresult-objects" title="Permanent link">&para;</a></h3>
<ul>
<li>Modules should typically return <code>Result</code> objects (or <code>ApiResult</code> for API endpoints) to provide standardized responses including success/error status, data payload, and informational messages.</li>
<li>The <code>toolboxv2.utils.system.types.Result</code> class provides factory methods:<ul>
<li><code>Result.ok(data=..., info=...)</code></li>
<li><code>Result.json(data=..., info=...)</code> (for <code>api=True</code> functions)</li>
<li><code>Result.html(data=..., info=...)</code></li>
<li><code>Result.text(text_data=..., info=...)</code></li>
<li><code>Result.binary(data=..., content_type=..., download_name=...)</code></li>
<li><code>Result.redirect(url=..., status_code=...)</code></li>
<li><code>Result.stream(stream_generator=..., info=..., cleanup_func=...)</code> (for SSE)</li>
<li><code>Result.default_user_error(info=..., exec_code=...)</code></li>
<li><code>Result.default_internal_error(info=..., exec_code=...)</code></li>
<li><code>Result.custom_error(data=..., info=..., exec_code=...)</code></li>
</ul>
</li>
<li>The <code>Result</code> object has a <code>task(background_task_callable)</code> method to schedule a background task to run after the main function returns.</li>
</ul>
<h3 id="requestdata-object"><code>RequestData</code> Object<a class="headerlink" href="#requestdata-object" title="Permanent link">&para;</a></h3>
<ul>
<li>For API functions (<code>api=True</code>) with <code>request_as_kwarg=True</code>, if the function signature includes <code>request: Optional[RequestData] = None</code>, it will receive an instance of <code>toolboxv2.utils.system.types.RequestData</code>.</li>
<li><code>RequestData</code> provides access to:<ul>
<li><code>request.method</code>, <code>request.path</code></li>
<li><code>request.headers</code> (an instance of <code>Headers</code>, e.g., <code>request.headers.user_agent</code>, <code>request.headers.hx_request</code>)</li>
<li><code>request.query_params</code> (dict)</li>
<li><code>request.form_data</code> (dict, if applicable)</li>
<li><code>request.body</code> (parsed JSON if <code>content_type</code> is <code>application/json</code>, otherwise raw bytes/str)</li>
<li><code>session.SiID</code>, <code>session.user_name</code>, <code>session.level</code> (from the current user's session)</li>
</ul>
</li>
</ul>
<h2 id="creating-a-maintool-based-module">Creating a <code>MainTool</code>-based Module<a class="headerlink" href="#creating-a-maintool-based-module" title="Permanent link">&para;</a></h2>
<p>For more complex, stateful modules, you can create a class that inherits from <code>toolboxv2.utils.system.main_tool.MainTool</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">toolboxv2</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_app</span><span class="p">,</span> <span class="n">App</span><span class="p">,</span> <span class="n">Result</span><span class="p">,</span> <span class="n">MainTool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">toolboxv2.utils.system.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolBoxError</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">get_app</span><span class="p">(</span><span class="s2">&quot;MyToolModule&quot;</span><span class="p">)</span>
<span class="n">export</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">tb</span>

<span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;MyToolModule&quot;</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;0.5.0&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Tools</span><span class="p">(</span><span class="n">MainTool</span><span class="p">):</span> <span class="c1"># The class must be named &#39;Tools&#39; for auto-detection by older App versions</span>
                      <span class="c1"># or ensure your module file directly uses @export on methods if not named Tools.</span>
    <span class="c1"># Or, you can export methods directly from any class:</span>
    <span class="c1"># class MyCustomTool(MainTool):</span>
    <span class="c1">#    @export(...)</span>
    <span class="c1">#    def my_method(self, ...): ...</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__ainit__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Asynchronous initialization</span>
        <span class="c1"># self.app is automatically available</span>
        <span class="c1"># self.name, self.version, self.logger are set by MainTool&#39;s __await__</span>
        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__ainit__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">Name</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;process_item&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_item</span><span class="p">,</span> <span class="c1"># For older compatibility if functions were in &#39;tools&#39; dict</span>
            <span class="s2">&quot;get_status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_state</span> <span class="o">=</span> <span class="s2">&quot;initialized&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (Tool) has been initialized with state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@export</span><span class="p">(</span><span class="n">mod_name</span><span class="o">=</span><span class="n">Name</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span> <span class="c1"># Decorate methods to export them</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">details</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
        <span class="c1"># &#39;self&#39; provides access to app, logger, name, version, config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> processing item: </span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_state</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;last_processed_</span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">item_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_result</span><span class="p">(</span> <span class="c1"># Helper from MainTool</span>
                <span class="n">error</span><span class="o">=</span><span class="n">ToolBoxError</span><span class="o">.</span><span class="n">input_error</span><span class="p">,</span>
                <span class="n">exec_code</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="c1"># Custom error code</span>
                <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Item ID cannot be zero.&quot;</span><span class="p">,</span>
                <span class="n">data_info</span><span class="o">=</span><span class="s2">&quot;Validation failed&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">Result</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="n">item_id</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;processed by tool&quot;</span><span class="p">})</span>

    <span class="nd">@export</span><span class="p">(</span><span class="n">mod_name</span><span class="o">=</span><span class="n">Name</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="c1"># Example async method</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Tool </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> current state: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_state</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Not automatically called unless also decorated or part of a convention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is shutting down its internal state.&quot;</span><span class="p">)</span>
        <span class="c1"># Perform cleanup</span>

<span class="c1"># To ensure on_exit is called by the App framework:</span>
<span class="nd">@export</span><span class="p">(</span><span class="n">mod_name</span><span class="o">=</span><span class="n">Name</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="n">exit_f</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">custom_tool_exit_function</span><span class="p">(</span><span class="n">app_instance</span><span class="p">:</span> <span class="n">App</span><span class="p">):</span>
    <span class="n">tool_instance</span> <span class="o">=</span> <span class="n">app_instance</span><span class="o">.</span><span class="n">get_mod</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tool_instance</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tool_instance</span><span class="p">,</span> <span class="s1">&#39;on_exit&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">tool_instance</span><span class="o">.</span><span class="n">on_exit</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">tool_instance</span><span class="o">.</span><span class="n">on_exit</span><span class="p">()</span>
</code></pre></div>
<p><strong>Key aspects of <code>MainTool</code>:</strong>
*   <strong>Asynchronous Initialization:</strong> Use <code>async def __ainit__(self)</code> for setup. The <code>MainTool</code> itself is awaitable, and <code>__ainit__</code> is called when the instance is first awaited (e.g., by <code>app.load_mod</code> or <code>app.get_mod</code>).
*   <strong><code>self.app</code>:</strong> The <code>App</code> instance is available as <code>self.app</code>.
*   <strong><code>self.name</code>, <code>self.version</code>, <code>self.logger</code>:</strong> These are automatically set up.
*   <strong><code>self.return_result(...)</code>:</strong> A helper method for creating <code>Result</code> objects.
*   Methods intended to be called via <code>app.run_any</code> should be decorated with <code>@export</code>.</p>
<h2 id="steps-to-create-a-valid-toolboxv2-module">Steps to Create a Valid Toolboxv2 Module:<a class="headerlink" href="#steps-to-create-a-valid-toolboxv2-module" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Define Module Structure:</strong> Organize your code with imports, metadata, and function/class definitions.</li>
<li><strong>Clarify Dependencies:</strong> Import necessary libraries. Handle missing optional dependencies gracefully if needed.</li>
<li><strong>Export Functions/Methods:</strong> Use the <code>@export(...)</code> decorator (e.g., <code>app.tb(...)</code>) to mark functions/methods that ToolBoxV2 should recognize.<ul>
<li>Provide <code>mod_name</code> and <code>version</code>.</li>
<li>Use other parameters (<code>api</code>, <code>row</code>, <code>initial</code>, <code>exit_f</code>, <code>memory_cache</code>, etc.) as needed.</li>
<li>Ensure clear signatures and document parameters/return types (Python type hints are highly recommended).</li>
</ul>
</li>
<li><strong>Documentation and Versioning:</strong> Document your module and its functions. Use semantic versioning.</li>
<li><strong>Testing:</strong> Test your module thoroughly, including how it integrates with the ToolBoxV2 app (<code>app.run_any</code>, <code>app.get_mod</code>, etc.). Use the <code>test=True</code> and <code>samples</code> parameters in <code>@export</code> to facilitate automated testing via <code>app.execute_all_functions()</code>.</li>
</ol>
<h1 id="to-isaa">To <a href="../isaa/">isaa</a><a class="headerlink" href="#to-isaa" title="Permanent link">&para;</a></h1>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "search.highlight"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>