
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://MarkinHaus.github.io/ToolBoxV2/isaa/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>ISAA (Intelligent System Agent Architecture) Module Documentation - ToolBoxV2 Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#isaa-intelligent-system-agent-architecture-module-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ToolBoxV2 Docs" class="md-header__button md-logo" aria-label="ToolBoxV2 Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ToolBoxV2 Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ISAA (Intelligent System Agent Architecture) Module Documentation
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/MarkinHaus/ToolBoxV2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ToolBoxV2
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ToolBoxV2 Docs" class="md-nav__button md-logo" aria-label="ToolBoxV2 Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ToolBoxV2 Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MarkinHaus/ToolBoxV2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ToolBoxV2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tbjs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TBjs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/MarkinHaus/ToolBoxV2/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Report Issues
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../toolboxv2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    toolboxv2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-overview" class="md-nav__link">
    <span class="md-ellipsis">
      1. Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      2. Core Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Core Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-enhancedagent" class="md-nav__link">
    <span class="md-ellipsis">
      2.1. EnhancedAgent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-enhancedagentbuilder" class="md-nav__link">
    <span class="md-ellipsis">
      2.2. EnhancedAgentBuilder
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-initialization-and-configuration-tools-class" class="md-nav__link">
    <span class="md-ellipsis">
      3. Initialization and Configuration (Tools Class)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Initialization and Configuration (Tools Class)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-configuration-isaaconfig" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. Configuration (isaa.config)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-isaaon_exit" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. isaa.on_exit()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-agent-management" class="md-nav__link">
    <span class="md-ellipsis">
      4. Agent Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Agent Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-getting-an-agent-builder-async-get_agent_builder" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Getting an Agent Builder (async get_agent_builder)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-registering-an-agent-async-register_agent" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Registering an Agent (async register_agent)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-retrieving-an-agent-instance-async-get_agent" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Retrieving an Agent Instance (async get_agent)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-running-agents-and-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      5. Running Agents and Tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Running Agents and Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-running-an-agent-async-run_agent" class="md-nav__link">
    <span class="md-ellipsis">
      5.1. Running an Agent (async run_agent)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-mini-task-completion-async-mini_task_completion" class="md-nav__link">
    <span class="md-ellipsis">
      5.2. Mini Task Completion (async mini_task_completion)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-structured-output-async-format_class" class="md-nav__link">
    <span class="md-ellipsis">
      5.3. Structured Output (async format_class)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-task-chains" class="md-nav__link">
    <span class="md-ellipsis">
      6. Task Chains
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Task Chains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-defining-a-task-chain" class="md-nav__link">
    <span class="md-ellipsis">
      6.1. Defining a Task Chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-creating-a-task-chain-async-crate_task_chain" class="md-nav__link">
    <span class="md-ellipsis">
      6.2. Creating a Task Chain (async crate_task_chain)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-managing-task-chains" class="md-nav__link">
    <span class="md-ellipsis">
      6.3. Managing Task Chains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-running-a-task-chain-async-run_task" class="md-nav__link">
    <span class="md-ellipsis">
      6.4. Running a Task Chain (async run_task)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-pipelines-for-code-execution-pipeline-class" class="md-nav__link">
    <span class="md-ellipsis">
      7. Pipelines for Code Execution (Pipeline Class)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Pipelines for Code Execution (Pipeline Class)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-getting-a-pipeline-instance-async-get_pipe" class="md-nav__link">
    <span class="md-ellipsis">
      7.1. Getting a Pipeline Instance (async get_pipe)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-running-a-pipeline-async-run_pipe" class="md-nav__link">
    <span class="md-ellipsis">
      7.2. Running a Pipeline (async run_pipe)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-semantic-memory-aisemanticmemory" class="md-nav__link">
    <span class="md-ellipsis">
      8. Semantic Memory (AISemanticMemory)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Semantic Memory (AISemanticMemory)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-accessing-memory-isaaget_memory" class="md-nav__link">
    <span class="md-ellipsis">
      8.1. Accessing Memory (isaa.get_memory)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-interacting-with-memory" class="md-nav__link">
    <span class="md-ellipsis">
      8.2. Interacting with Memory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-tool-integration" class="md-nav__link">
    <span class="md-ellipsis">
      9. Tool Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Tool Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-default-isaa-tools" class="md-nav__link">
    <span class="md-ellipsis">
      9.1. Default ISAA Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-adding-custom-and-langchain-tools-async-init_tools" class="md-nav__link">
    <span class="md-ellipsis">
      9.2. Adding Custom and LangChain Tools (async init_tools)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-example-usage-flow" class="md-nav__link">
    <span class="md-ellipsis">
      10. Example Usage Flow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-important-notes" class="md-nav__link">
    <span class="md-ellipsis">
      11. Important Notes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  


  
  


<h1 id="isaa-intelligent-system-agent-architecture-module-documentation">ISAA (Intelligent System Agent Architecture) Module Documentation<a class="headerlink" href="#isaa-intelligent-system-agent-architecture-module-documentation" title="Permanent link">&para;</a></h1>
<p><strong>Version:</strong> 0.2.0</p>
<h2 id="1-overview">1. Overview<a class="headerlink" href="#1-overview" title="Permanent link">&para;</a></h2>
<p>The ISAA module provides a comprehensive framework for building, managing, and orchestrating AI agents. It leverages the <code>EnhancedAgent</code> and <code>EnhancedAgentBuilder</code> for creating sophisticated agents with capabilities like tool use, code execution, web interaction, and persistent memory. The module is designed to be extensible and configurable, allowing developers to create complex multi-agent systems and automated workflows.</p>
<p>Key features include:
*   <strong>Advanced Agent System</strong>: Based on <code>EnhancedAgent</code> for robust and production-ready agents.
*   <strong>Flexible Agent Configuration</strong>: Uses <code>EnhancedAgentBuilder</code> for fluent and detailed agent setup.
*   <strong>Task Chain Management</strong>: Define and execute sequences of agent actions or tool uses.
*   <strong>Interactive Code Execution Pipelines</strong>: Stateful Python execution environments for agents.
*   <strong>Semantic Memory</strong>: Persistent knowledge storage and retrieval using <code>AISemanticMemory</code>.
*   <strong>Tool Integration</strong>: Supports ADK-compatible tools, custom functions, and has provisions for LangChain tools.
*   <strong>Asynchronous Operations</strong>: Many core functionalities are <code>async</code> for better performance.</p>
<h2 id="2-core-concepts">2. Core Concepts<a class="headerlink" href="#2-core-concepts" title="Permanent link">&para;</a></h2>
<h3 id="21-enhancedagent">2.1. <code>EnhancedAgent</code><a class="headerlink" href="#21-enhancedagent" title="Permanent link">&para;</a></h3>
<p>The <code>EnhancedAgent</code> is the primary agent class in ISAA. It integrates:
*   <strong>LiteLLM</strong>: For interaction with a wide range of LLMs.
*   <strong>ADK (Agent Development Kit)</strong>: For structured tool use, planning, and code execution (if ADK is available and configured).
*   <strong>A2A (Agent-to-Agent)</strong>: For inter-agent communication (if A2A is available).
*   <strong>MCP (Model Context Protocol)</strong>: For exposing agent capabilities (if MCP is available).
*   <strong>World Model</strong>: A dictionary-like persistent state for the agent.
*   <strong>Cost Tracking</strong>: Built-in user cost tracking.
*   <strong>Callbacks</strong>: For streaming, progress, and post-run actions.</p>
<h3 id="22-enhancedagentbuilder">2.2. <code>EnhancedAgentBuilder</code><a class="headerlink" href="#22-enhancedagentbuilder" title="Permanent link">&para;</a></h3>
<p>The <code>EnhancedAgentBuilder</code> provides a fluent API to configure and construct <code>EnhancedAgent</code> instances. Key aspects:
*   <strong>Configuration Model (<code>BuilderConfig</code>)</strong>: A Pydantic model that holds all serializable configurations for an agent. This can be saved to and loaded from JSON.
*   <strong>Model Configuration</strong>: Specify LLM model, API keys (via env vars), temperature, etc.
*   <strong>Behavior</strong>: Streaming, logging, initial world model data.
*   <strong>Framework Integrations</strong>: Enable and configure ADK, A2A, MCP.
*   <strong>Tool Management</strong>: Add ADK tools (including wrapped functions).
*   <strong>Cost Tracking</strong>: Configure persistence for user costs.
*   <strong>Telemetry</strong>: Configure OpenTelemetry.</p>
<h2 id="3-initialization-and-configuration-tools-class">3. Initialization and Configuration (<code>Tools</code> Class)<a class="headerlink" href="#3-initialization-and-configuration-tools-class" title="Permanent link">&para;</a></h2>
<p>The <code>Tools</code> class is the main entry point for interacting with the ISAA module.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">toolboxv2</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_app</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">toolboxv2.mods.isaa.module</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tools</span>

<span class="c1"># Get the application instance (if using toolboxv2 framework)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">get_app</span><span class="p">(</span><span class="s2">&quot;my_application&quot;</span><span class="p">)</span>
<span class="n">isaa</span> <span class="o">=</span> <span class="n">Tools</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">)</span> <span class="c1"># or isaa = app.get_mod(&quot;isaa&quot;) if registered</span>

<span class="c1"># Initialize ISAA (loads configs, sets up defaults)</span>
<span class="c1"># This is now an async operation if it involves building default agents</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize_isaa</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">init_isaa</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ISAA initialized.&quot;</span><span class="p">)</span>

<span class="c1"># asyncio.run(initialize_isaa())</span>
</code></pre></div></td></tr></table></div>
<h3 id="31-configuration-isaaconfig">3.1. Configuration (<code>isaa.config</code>)<a class="headerlink" href="#31-configuration-isaaconfig" title="Permanent link">&para;</a></h3>
<p>The <code>isaa.config</code> dictionary holds various settings:
*   <code>DEFAULTMODEL*</code>: Default LLM model identifiers for different agent types (e.g., <code>DEFAULTMODEL0</code>, <code>DEFAULTMODELCODE</code>). These can be overridden by environment variables.
*   <code>agents-name-list</code>: A list of registered agent names.
*   <code>controller_file</code>: Path to the JSON file for <code>ControllerManager</code> (LLM modes).
*   Other internal states and paths.</p>
<p>API keys (like <code>OPENAI_API_KEY</code>, <code>GEMINI_API_KEY</code>, etc.) are typically loaded from environment variables by LiteLLM or explicitly set in the <code>EnhancedAgentBuilder</code> via <code>with_api_key_from_env()</code>.</p>
<h3 id="32-isaaon_exit">3.2. <code>isaa.on_exit()</code><a class="headerlink" href="#32-isaaon_exit" title="Permanent link">&para;</a></h3>
<p>Called when the application or module shuts down. It saves:
*   Agent builder configurations (<code>BuilderConfig</code> dicts from <code>isaa.agent_data</code>).
*   <code>ControllerManager</code> state.
*   <code>AgentChain</code> definitions.
*   <code>Scripts</code> definitions.
*   ISAA <code>Tools</code> class configuration.</p>
<h2 id="4-agent-management">4. Agent Management<a class="headerlink" href="#4-agent-management" title="Permanent link">&para;</a></h2>
<p>All agent management functions are now primarily <code>async</code>.</p>
<h3 id="41-getting-an-agent-builder-async-get_agent_builder">4.1. Getting an Agent Builder (<code>async get_agent_builder</code>)<a class="headerlink" href="#41-getting-an-agent-builder-async-get_agent_builder" title="Permanent link">&para;</a></h3>
<p>This method returns a pre-configured <code>EnhancedAgentBuilder</code> instance.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">manage_agent_builder</span><span class="p">():</span>
    <span class="c1"># Get a default builder for an agent named &quot;coder_agent&quot;</span>
    <span class="n">coder_builder</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent_builder</span><span class="p">(</span><span class="s2">&quot;coder_agent&quot;</span><span class="p">)</span>

    <span class="c1"># Further configure the builder</span>
    <span class="n">coder_builder</span><span class="o">.</span><span class="n">with_model</span><span class="p">(</span><span class="s2">&quot;anthropic/claude-3-haiku-20240229&quot;</span><span class="p">)</span>
    <span class="n">coder_builder</span><span class="o">.</span><span class="n">with_system_message</span><span class="p">(</span><span class="s2">&quot;You are a master Python programmer.&quot;</span><span class="p">)</span>
    <span class="n">coder_builder</span><span class="o">.</span><span class="n">enable_adk_code_executor</span><span class="p">(</span><span class="s2">&quot;adk_builtin&quot;</span><span class="p">)</span> <span class="c1"># If ADK is available</span>

    <span class="c1"># ... other configurations ...</span>
    <span class="k">return</span> <span class="n">coder_builder</span>
</code></pre></div></td></tr></table></div>
Default builders come with common ISAA tools like <code>runAgent</code>, <code>memorySearch</code>, <code>searchWeb</code>, and <code>shell</code>.</p>
<h3 id="42-registering-an-agent-async-register_agent">4.2. Registering an Agent (<code>async register_agent</code>)<a class="headerlink" href="#42-registering-an-agent-async-register_agent" title="Permanent link">&para;</a></h3>
<p>Once an <code>EnhancedAgentBuilder</code> is configured, its configuration can be registered with ISAA. The agent instance itself will be built on demand.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">register_my_agent</span><span class="p">():</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent_builder</span><span class="p">(</span><span class="s2">&quot;my_query_agent&quot;</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">with_system_message</span><span class="p">(</span><span class="s2">&quot;You answer questions based on internal memory.&quot;</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">register_agent</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Agent &#39;my_query_agent&#39; configuration registered.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
This saves the builder's configuration to a JSON file (e.g., <code>.data/app_id/Agents/my_query_agent.agent.json</code>) and stores the config dictionary in <code>isaa.agent_data</code>.</p>
<h3 id="43-retrieving-an-agent-instance-async-get_agent">4.3. Retrieving an Agent Instance (<code>async get_agent</code>)<a class="headerlink" href="#43-retrieving-an-agent-instance-async-get_agent" title="Permanent link">&para;</a></h3>
<p>This <code>async</code> method retrieves (and builds if necessary) an <code>EnhancedAgent</code> instance.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">retrieve_and_use_agent</span><span class="p">():</span>
    <span class="n">my_agent</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent</span><span class="p">(</span><span class="s2">&quot;my_query_agent&quot;</span><span class="p">)</span>
    <span class="c1"># my_agent is now an instance of EnhancedAgent</span>

    <span class="c1"># If you need to override the model for this instance (will rebuild if different)</span>
    <span class="c1"># my_agent_gpt4 = await isaa.get_agent(&quot;my_query_agent&quot;, model_override=&quot;openai/gpt-4-turbo&quot;)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">my_agent</span><span class="o">.</span><span class="n">a_run</span><span class="p">(</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
If an agent configuration exists, it's loaded. Otherwise, a default builder is used. The agent instance is cached in <code>isaa.config['agent-instance-{name}']</code>.</p>
<h2 id="5-running-agents-and-tasks">5. Running Agents and Tasks<a class="headerlink" href="#5-running-agents-and-tasks" title="Permanent link">&para;</a></h2>
<h3 id="51-running-an-agent-async-run_agent">5.1. Running an Agent (<code>async run_agent</code>)<a class="headerlink" href="#51-running-an-agent-async-run_agent" title="Permanent link">&para;</a></h3>
<p>This is the primary method to interact with a registered agent.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_specific_agent</span><span class="p">():</span>
    <span class="c1"># Ensure agent is registered (e.g., during init_isaa or manually)</span>
    <span class="c1"># For example, register a &#39;self&#39; agent if not already present</span>
    <span class="k">if</span> <span class="s2">&quot;self&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">isaa</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;agents-name-list&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">self_builder</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent_builder</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">register_agent</span><span class="p">(</span><span class="n">self_builder</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">run_agent</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;Tell me a joke.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Self agent says: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Example with session_id for persistent history with EnhancedAgent</span>
    <span class="n">session_id</span> <span class="o">=</span> <span class="s2">&quot;user123_chat_session&quot;</span>
    <span class="n">response1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">run_agent</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;My name is Bob.&quot;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">)</span>
    <span class="n">response2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">run_agent</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;What is my name?&quot;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent remembers: </span><span class="si">{</span><span class="n">response2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
The <code>run_agent</code> method now calls the <code>EnhancedAgent.a_run()</code> method, which supports features like session-based history, world model updates, ADK tool execution, etc.</p>
<h3 id="52-mini-task-completion-async-mini_task_completion">5.2. Mini Task Completion (<code>async mini_task_completion</code>)<a class="headerlink" href="#52-mini-task-completion-async-mini_task_completion" title="Permanent link">&para;</a></h3>
<p>For quick, one-off LLM calls without full agent capabilities.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_mini_task</span><span class="p">():</span>
    <span class="n">translation</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">mini_task_completion</span><span class="p">(</span>
        <span class="n">mini_task</span><span class="o">=</span><span class="s2">&quot;Translate to German.&quot;</span><span class="p">,</span>
        <span class="n">user_task</span><span class="o">=</span><span class="s2">&quot;Hello, how are you?&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Translation: </span><span class="si">{</span><span class="n">translation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="53-structured-output-async-format_class">5.3. Structured Output (<code>async format_class</code>)<a class="headerlink" href="#53-structured-output-async-format_class" title="Permanent link">&para;</a></h3>
<p>To get LLM output structured according to a Pydantic model.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserInfo</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_structured_info</span><span class="p">():</span>
    <span class="n">user_data_dict</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">format_class</span><span class="p">(</span>
        <span class="n">UserInfo</span><span class="p">,</span>
        <span class="s2">&quot;The user is Alice, 30 years old, from New York.&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">user_data_dict</span><span class="p">:</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="n">UserInfo</span><span class="p">(</span><span class="o">**</span><span class="n">user_data_dict</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parsed User: </span><span class="si">{</span><span class="n">user_info</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, Age: </span><span class="si">{</span><span class="n">user_info</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="6-task-chains">6. Task Chains<a class="headerlink" href="#6-task-chains" title="Permanent link">&para;</a></h2>
<p>Task chains allow defining a sequence of operations involving agents or tools.</p>
<h3 id="61-defining-a-task-chain">6.1. Defining a Task Chain<a class="headerlink" href="#61-defining-a-task-chain" title="Permanent link">&para;</a></h3>
<p>Task chains are defined as lists of dictionaries, where each dictionary represents a task.
The <code>TaskChain</code> Pydantic model from <code>toolboxv2.mods.isaa.types</code> can be used for validation.</p>
<p>Example structure for a task in the list:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;use&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;agent&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// &quot;agent&quot;, &quot;tool&quot;, &quot;chain&quot;</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;agent_name_or_tool_name_or_chain_name&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prompt or arguments, can use $variable or $user-input&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;return_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my_result_variable&quot;</span><span class="w"> </span><span class="c1">// Result stored under this key</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="62-creating-a-task-chain-async-crate_task_chain">6.2. Creating a Task Chain (<code>async crate_task_chain</code>)<a class="headerlink" href="#62-creating-a-task-chain-async-crate_task_chain" title="Permanent link">&para;</a></h3>
<p>Uses an LLM (typically "TaskChainAgent") to generate a task chain definition from a natural language prompt.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_my_chain</span><span class="p">():</span>
    <span class="n">chain_name</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">crate_task_chain</span><span class="p">(</span>
        <span class="s2">&quot;Create a plan to research a topic: first search the web, then summarize findings.&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">chain_name</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task chain &#39;</span><span class="si">{</span><span class="n">chain_name</span><span class="si">}</span><span class="s2">&#39; created.&quot;</span><span class="p">)</span>
        <span class="n">isaa</span><span class="o">.</span><span class="n">save_task</span><span class="p">(</span><span class="n">chain_name</span><span class="p">)</span> <span class="c1"># Save it</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to create task chain.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="63-managing-task-chains">6.3. Managing Task Chains<a class="headerlink" href="#63-managing-task-chains" title="Permanent link">&para;</a></h3>
<ul>
<li><code>isaa.add_task(chain_name, task_definition_list)</code>: Manually add/update a chain.</li>
<li><code>isaa.get_task(chain_name)</code>: Get the definition of a chain.</li>
<li><code>isaa.list_task()</code>: List names of all available chains.</li>
<li><code>isaa.save_task(chain_name=None)</code>: Save one or all chains to file.</li>
<li><code>isaa.load_task(chain_name=None)</code>: Load one or all chains from file.</li>
</ul>
<h3 id="64-running-a-task-chain-async-run_task">6.4. Running a Task Chain (<code>async run_task</code>)<a class="headerlink" href="#64-running-a-task-chain-async-run_task" title="Permanent link">&para;</a></h3>
<p>Executes a defined task chain.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_my_chain</span><span class="p">():</span>
    <span class="c1"># Assume &quot;research_topic_chain&quot; was created and saved earlier</span>
    <span class="n">isaa</span><span class="o">.</span><span class="n">load_task</span><span class="p">(</span><span class="s2">&quot;research_topic_chain&quot;</span><span class="p">)</span> <span class="c1"># Load if not already in memory</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">run_task</span><span class="p">(</span>
        <span class="n">task_input</span><span class="o">=</span><span class="s2">&quot;Quantum computing advancements in 2024&quot;</span><span class="p">,</span>
        <span class="n">chain_name</span><span class="o">=</span><span class="s2">&quot;research_topic_chain&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task chain execution results:&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
The <code>ChainTreeExecutor</code> handles variable injection (<code>$variable_name</code>, <code>$user-input</code>) and result passing between tasks.</p>
<h2 id="7-pipelines-for-code-execution-pipeline-class">7. Pipelines for Code Execution (<code>Pipeline</code> Class)<a class="headerlink" href="#7-pipelines-for-code-execution-pipeline-class" title="Permanent link">&para;</a></h2>
<p>The <code>Pipeline</code> class (from <code>toolboxv2.mods.isaa.CodingAgent.live</code>) provides a stateful environment for agents to execute Python code iteratively. It uses a mock IPython interface.</p>
<h3 id="71-getting-a-pipeline-instance-async-get_pipe">7.1. Getting a Pipeline Instance (<code>async get_pipe</code>)<a class="headerlink" href="#71-getting-a-pipeline-instance-async-get_pipe" title="Permanent link">&para;</a></h3>
<p>Retrieves or creates a <code>Pipeline</code> instance associated with a specific ISAA agent. The agent's context (variables, potentially its LLM for thinking within the pipeline) can influence the pipeline's behavior.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup_pipeline</span><span class="p">():</span>
    <span class="c1"># Get a pipeline associated with the &#39;coder_agent&#39;</span>
    <span class="c1"># Ensure &#39;coder_agent&#39; is registered</span>
    <span class="n">coder_agent_builder</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent_builder</span><span class="p">(</span><span class="s2">&quot;coder_agent&quot;</span><span class="p">)</span>
    <span class="n">coder_agent_builder</span><span class="o">.</span><span class="n">with_system_message</span><span class="p">(</span><span class="s2">&quot;You write and execute Python code to solve problems.&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">register_agent</span><span class="p">(</span><span class="n">coder_agent_builder</span><span class="p">)</span>

    <span class="n">coder_pipeline</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_pipe</span><span class="p">(</span><span class="s2">&quot;coder_agent&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coder_pipeline</span>
</code></pre></div></td></tr></table></div>
<h3 id="72-running-a-pipeline-async-run_pipe">7.2. Running a Pipeline (<code>async run_pipe</code>)<a class="headerlink" href="#72-running-a-pipeline-async-run_pipe" title="Permanent link">&para;</a></h3>
<p>Executes a task within the pipeline. The agent associated with the pipeline will "think" and generate code or actions to be executed by the pipeline's IPython environment.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_pipeline_task</span><span class="p">():</span>
    <span class="n">coder_pipeline</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_pipe</span><span class="p">(</span><span class="s2">&quot;coder_agent&quot;</span><span class="p">)</span> <span class="c1"># Assumes &quot;coder_agent&quot; is set up</span>

    <span class="n">task_description</span> <span class="o">=</span> <span class="s2">&quot;Define a function to calculate factorial and test it with n=5.&quot;</span>
    <span class="n">pipeline_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coder_pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">task_description</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline Final Result: </span><span class="si">{</span><span class="n">pipeline_result</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Execution History:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">pipeline_result</span><span class="o">.</span><span class="n">execution_history</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Code: </span><span class="si">{</span><span class="n">record</span><span class="o">.</span><span class="n">code</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">... -&gt; Result: </span><span class="si">{</span><span class="n">record</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">, Error: </span><span class="si">{</span><span class="n">record</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final Variables in Pipeline:&quot;</span><span class="p">,</span> <span class="n">pipeline_result</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
The <code>Pipeline.run</code> method involves multiple turns of the agent thinking, generating code/actions, and the pipeline executing them, until the task is marked "done" or iterations are exhausted.</p>
<h2 id="8-semantic-memory-aisemanticmemory">8. Semantic Memory (<code>AISemanticMemory</code>)<a class="headerlink" href="#8-semantic-memory-aisemanticmemory" title="Permanent link">&para;</a></h2>
<p>ISAA uses <code>AISemanticMemory</code> for persistent, semantic storage and retrieval of information.</p>
<h3 id="81-accessing-memory-isaaget_memory">8.1. Accessing Memory (<code>isaa.get_memory</code>)<a class="headerlink" href="#81-accessing-memory-isaaget_memory" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Get the global AISemanticMemory instance</span>
<span class="n">semantic_memory</span> <span class="o">=</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_memory</span><span class="p">()</span>

<span class="c1"># AISemanticMemory can manage multiple named &quot;memory spaces&quot; (KnowledgeBase instances)</span>
<span class="c1"># To get a specific KnowledgeBase instance (e.g., for an agent):</span>
<span class="n">agent_kb</span> <span class="o">=</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_memory</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_agent_context&quot;</span><span class="p">)</span> <span class="c1"># This will create if not exists</span>
</code></pre></div></td></tr></table></div>
<h3 id="82-interacting-with-memory">8.2. Interacting with Memory<a class="headerlink" href="#82-interacting-with-memory" title="Permanent link">&para;</a></h3>
<p>The <code>AISemanticMemory</code> class (and its underlying <code>KnowledgeBase</code> instances) provides methods like:
*   <code>async add_data(memory_name: str, data: ..., metadata: ...)</code>: Adds data to a specific memory space.
*   <code>async query(query: str, memory_names: ..., to_str: bool)</code>: Queries one or more memory spaces.
*   <code>async unified_retrieve(...)</code>: A more comprehensive retrieval method.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">use_semantic_memory</span><span class="p">():</span>
    <span class="n">mem</span> <span class="o">=</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_memory</span><span class="p">()</span>
    <span class="n">agent_name</span> <span class="o">=</span> <span class="s2">&quot;researcher&quot;</span>

    <span class="c1"># Ensure the agent&#39;s memory space exists (usually handled by agent init)</span>
    <span class="k">await</span> <span class="n">mem</span><span class="o">.</span><span class="n">create_memory</span><span class="p">(</span><span class="n">agent_name</span><span class="p">)</span> <span class="c1"># Or rely on get_memory(name=...)</span>

    <span class="c1"># Add data</span>
    <span class="k">await</span> <span class="n">mem</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span>
        <span class="n">memory_name</span><span class="o">=</span><span class="n">agent_name</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="s2">&quot;Photosynthesis is a process used by plants to convert light energy into chemical energy.&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;biology_notes&quot;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Query data</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mem</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;How do plants get energy?&quot;</span><span class="p">,</span>
        <span class="n">memory_names</span><span class="o">=</span><span class="p">[</span><span class="n">agent_name</span><span class="p">],</span>
        <span class="n">to_str</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Memory search results: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<code>EnhancedAgent</code> instances often have their world model, but can also interact with <code>AISemanticMemory</code> via tools for broader knowledge. <code>ChatSession</code> (used by <code>Pipeline</code>) also uses <code>AISemanticMemory</code>.</p>
<h2 id="9-tool-integration">9. Tool Integration<a class="headerlink" href="#9-tool-integration" title="Permanent link">&para;</a></h2>
<h3 id="91-default-isaa-tools">9.1. Default ISAA Tools<a class="headerlink" href="#91-default-isaa-tools" title="Permanent link">&para;</a></h3>
<p>Agents created with <code>get_agent_builder</code> automatically get several tools:
*   <code>runAgent</code>: To call other registered ISAA agents.
*   <code>memorySearch</code>: To query the <code>AISemanticMemory</code>.
*   <code>saveDataToMemory</code>: To save data into the agent's context in <code>AISemanticMemory</code>.
*   <code>searchWeb</code>: Uses <code>WebScraper</code> to search the internet.
*   <code>shell</code>: Executes shell commands using <code>shell_tool_function</code>.
*   <code>runCodePipeline</code> (for agents like "self", "code"): To invoke a <code>Pipeline</code> task.</p>
<p>These are added as ADK-compatible function tools to the <code>EnhancedAgentBuilder</code>.</p>
<h3 id="92-adding-custom-and-langchain-tools-async-init_tools">9.2. Adding Custom and LangChain Tools (<code>async init_tools</code>)<a class="headerlink" href="#92-adding-custom-and-langchain-tools-async-init_tools" title="Permanent link">&para;</a></h3>
<p>The <code>init_tools</code> method is intended for adding external tools, particularly LangChain tools, to an agent <em>builder</em>.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># This is a conceptual example, as init_tools itself needs to be fully async</span>
<span class="c1"># and adapt to how EnhancedAgentBuilder handles external tool definitions.</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_external_tools</span><span class="p">():</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent_builder</span><span class="p">(</span><span class="s2">&quot;tool_user_agent&quot;</span><span class="p">)</span>

    <span class="c1"># Configuration for tools (example)</span>
    <span class="n">tools_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;lagChinTools&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;wikipedia&quot;</span><span class="p">,</span> <span class="s2">&quot;ddg-search&quot;</span><span class="p">],</span> <span class="c1"># Example LangChain tool names</span>
        <span class="c1"># &quot;huggingTools&quot;: [], # HF tools are also LC tools</span>
        <span class="c1"># &quot;Plugins&quot;: [] # AIPluginTool</span>
    <span class="p">}</span>

    <span class="c1"># init_tools would modify the builder by adding wrapped LangChain tools</span>
    <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">init_tools</span><span class="p">(</span><span class="n">tools_config</span><span class="p">,</span> <span class="n">builder</span><span class="p">)</span> <span class="c1"># Pass the builder instance</span>

    <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">register_agent</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>

    <span class="n">agent_with_tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent</span><span class="p">(</span><span class="s2">&quot;tool_user_agent&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent_with_tools</span><span class="o">.</span><span class="n">a_run</span><span class="p">(</span><span class="s2">&quot;Search Wikipedia for &#39;Large Language Models&#39;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<strong>Note</strong>: Wrapping arbitrary LangChain tools (which can have complex Pydantic <code>args_schema</code>) into ADK <code>FunctionTool</code>s (which prefer simpler schemas or Pydantic models for arguments) can be non-trivial. <code>init_tools</code> will need careful implementation to handle schema mapping or require tools to be provided as simple callables.</p>
<h2 id="10-example-usage-flow">10. Example Usage Flow<a class="headerlink" href="#10-example-usage-flow" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">toolboxv2</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_app</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">toolboxv2.mods.isaa.module</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="c1"># --- Setup ---</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">get_app</span><span class="p">(</span><span class="s2">&quot;isaa_demo_app&quot;</span><span class="p">)</span>
<span class="n">isaa</span> <span class="o">=</span> <span class="n">Tools</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">)</span>

<span class="c1"># --- Pydantic Model for Structured Output ---</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AnalysisResult</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">topic</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">key_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">sentiment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main_demo</span><span class="p">():</span>
    <span class="c1"># 1. Initialize ISAA (loads configs, ControllerManager, etc.)</span>
    <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">init_isaa</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ISAA Initialized.&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Create and Register a &quot;Researcher&quot; Agent</span>
    <span class="n">researcher_builder</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent_builder</span><span class="p">(</span><span class="s2">&quot;Researcher&quot;</span><span class="p">)</span>
    <span class="n">researcher_builder</span><span class="o">.</span><span class="n">with_system_message</span><span class="p">(</span>
        <span class="s2">&quot;You are a research assistant. Your job is to find information using web search and summarize it.&quot;</span>
    <span class="p">)</span>
    <span class="n">researcher_builder</span><span class="o">.</span><span class="n">with_model</span><span class="p">(</span><span class="s2">&quot;openai/gpt-3.5-turbo&quot;</span><span class="p">)</span> <span class="c1"># Example model</span>
    <span class="c1"># The default builder already adds searchWeb and memory tools.</span>
    <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">register_agent</span><span class="p">(</span><span class="n">researcher_builder</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Researcher agent registered.&quot;</span><span class="p">)</span>

    <span class="c1"># 3. Create and Register a &quot;Summarizer&quot; Agent for structured output</span>
    <span class="n">summarizer_builder</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent_builder</span><span class="p">(</span><span class="s2">&quot;Summarizer&quot;</span><span class="p">)</span>
    <span class="n">summarizer_builder</span><span class="o">.</span><span class="n">with_system_message</span><span class="p">(</span>
        <span class="s2">&quot;You summarize text and extract key information into a structured format.&quot;</span>
    <span class="p">)</span>
    <span class="n">summarizer_builder</span><span class="o">.</span><span class="n">with_model</span><span class="p">(</span><span class="s2">&quot;openai/gpt-4-turbo&quot;</span><span class="p">)</span> <span class="c1"># Example model, good for JSON</span>
    <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">register_agent</span><span class="p">(</span><span class="n">summarizer_builder</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Summarizer agent registered.&quot;</span><span class="p">)</span>

    <span class="c1"># 4. Define a Task Chain</span>
    <span class="n">chain_name</span> <span class="o">=</span> <span class="s2">&quot;WebResearchAndAnalyze&quot;</span>
    <span class="n">research_tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;agent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Researcher&quot;</span><span class="p">,</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="s2">&quot;Find recent news about AI in healthcare. Focus on the top 3 articles. User input: $user-input&quot;</span><span class="p">,</span> <span class="c1"># $user-input will be main query</span>
            <span class="s2">&quot;return_key&quot;</span><span class="p">:</span> <span class="s2">&quot;research_findings&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;agent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Summarizer&quot;</span><span class="p">,</span>
            <span class="c1"># The &#39;Summarizer&#39; agent will use its format_class capability internally if prompted correctly</span>
            <span class="c1"># For this example, we assume &#39;Summarizer&#39; is prompted to produce AnalysisResult</span>
            <span class="c1"># A more robust way is to have a specific tool/agent that *only* does formatting.</span>
            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="s2">&quot;Analyze the following research findings and structure them: $research_findings. Extract topic, key points, and sentiment.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return_key&quot;</span><span class="p">:</span> <span class="s2">&quot;structured_analysis&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">isaa</span><span class="o">.</span><span class="n">agent_chain</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">chain_name</span><span class="p">,</span> <span class="n">research_tasks</span><span class="p">)</span>
    <span class="n">isaa</span><span class="o">.</span><span class="n">save_task</span><span class="p">(</span><span class="n">chain_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task chain &#39;</span><span class="si">{</span><span class="n">chain_name</span><span class="si">}</span><span class="s2">&#39; created and saved.&quot;</span><span class="p">)</span>

    <span class="c1"># 5. Run the Task Chain</span>
    <span class="n">user_query</span> <span class="o">=</span> <span class="s2">&quot;Latest breakthroughs in AI-driven drug discovery&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Running task chain &#39;</span><span class="si">{</span><span class="n">chain_name</span><span class="si">}</span><span class="s2">&#39; for query: &#39;</span><span class="si">{</span><span class="n">user_query</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="n">chain_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">run_task</span><span class="p">(</span><span class="n">user_query</span><span class="p">,</span> <span class="n">chain_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Task Chain Results ---&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">chain_results</span> <span class="ow">and</span> <span class="s2">&quot;structured_analysis&quot;</span> <span class="ow">in</span> <span class="n">chain_results</span><span class="p">:</span>
        <span class="n">analysis_output</span> <span class="o">=</span> <span class="n">chain_results</span><span class="p">[</span><span class="s2">&quot;structured_analysis&quot;</span><span class="p">]</span>
        <span class="c1"># If the summarizer agent directly returned a dict matching AnalysisResult:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># The result from an agent run is typically a string.</span>
            <span class="c1"># If the &#39;Summarizer&#39; was specifically designed to output JSON string for AnalysisResult:</span>
            <span class="n">analysis_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">analysis_output</span><span class="p">)</span> <span class="c1"># Agent must output valid JSON string</span>
            <span class="n">structured_data</span> <span class="o">=</span> <span class="n">AnalysisResult</span><span class="p">(</span><span class="o">**</span><span class="n">analysis_dict</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Topic: </span><span class="si">{</span><span class="n">structured_data</span><span class="o">.</span><span class="n">topic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Key Points:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">structured_data</span><span class="o">.</span><span class="n">key_points</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">structured_data</span><span class="o">.</span><span class="n">sentiment</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sentiment: </span><span class="si">{</span><span class="n">structured_data</span><span class="o">.</span><span class="n">sentiment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse structured analysis: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Raw analysis output:&quot;</span><span class="p">,</span> <span class="n">analysis_output</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chain did not produce expected &#39;structured_analysis&#39;. Full results:&quot;</span><span class="p">,</span> <span class="n">chain_results</span><span class="p">)</span>

    <span class="c1"># 6. Example of using a Pipeline with a &quot;Coder&quot; agent</span>
    <span class="n">coder_builder</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_agent_builder</span><span class="p">(</span><span class="s2">&quot;PyCoder&quot;</span><span class="p">)</span>
    <span class="n">coder_builder</span><span class="o">.</span><span class="n">with_system_message</span><span class="p">(</span><span class="s2">&quot;You are a Python coding assistant. You write and execute Python code to solve problems. Ensure your code prints results or returns values.&quot;</span><span class="p">)</span>
    <span class="n">coder_builder</span><span class="o">.</span><span class="n">enable_adk_code_executor</span><span class="p">(</span><span class="s2">&quot;unsafe_simple&quot;</span><span class="p">)</span> <span class="c1"># Or &quot;adk_builtin&quot; if model supports</span>
    <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">register_agent</span><span class="p">(</span><span class="n">coder_builder</span><span class="p">)</span>

    <span class="n">py_coder_pipeline</span> <span class="o">=</span> <span class="k">await</span> <span class="n">isaa</span><span class="o">.</span><span class="n">get_pipe</span><span class="p">(</span><span class="s2">&quot;PyCoder&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Get pipeline for this agent</span>
    <span class="n">pipeline_task</span> <span class="o">=</span> <span class="s2">&quot;Write a Python function that takes a list of numbers and returns their sum. Then, call this function with the list [1, 2, 3, 4, 5] and print the result.&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Running Pipeline for task: &#39;</span><span class="si">{</span><span class="n">pipeline_task</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="n">pipeline_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">py_coder_pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pipeline_task</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Pipeline Final Output ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pipeline_result</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Pipeline Variables ---&quot;</span><span class="p">)</span>
    <span class="c1"># Filter out internal IPython variables for clarity</span>
    <span class="n">final_vars</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pipeline_result</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;In&#39;</span><span class="p">,</span> <span class="s1">&#39;Out&#39;</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="s1">&#39;quit&#39;</span><span class="p">,</span> <span class="s1">&#39;get_ipython&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">]}</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">final_vars</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># 7. Clean up (optional, as on_exit handles saving)</span>
    <span class="c1"># isaa.on_exit()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main_demo</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h2 id="11-important-notes">11. Important Notes<a class="headerlink" href="#11-important-notes" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Asynchronous Nature</strong>: Most core methods of the <code>Tools</code> class are now <code>async</code>. Ensure your calling code uses <code>await</code> appropriately or runs within an asyncio event loop.</li>
<li><strong>Agent Configuration</strong>: Agent capabilities are primarily defined by their system message, the tools provided to them via the <code>EnhancedAgentBuilder</code>, and their underlying LLM model.</li>
<li><strong>Error Handling</strong>: Robust error handling should be implemented around <code>async</code> calls, especially for network-dependent operations like LLM calls or web interactions.</li>
<li><strong>ADK Integration</strong>: Full ADK functionality (planning, advanced tool schemas, long-running operations) requires Google ADK to be installed and properly configured. The <code>EnhancedAgentBuilder</code> provides methods like <code>with_adk_code_executor</code>, <code>with_adk_tool_instance</code>, etc.</li>
<li><strong>Security</strong>: Be cautious when enabling code execution (<code>unsafe_simple</code> executor is for development only) or shell access.</li>
</ul>
<p>This documentation provides a starting point for using the refactored ISAA module. As the module evolves, further details on specific component interactions (e.g., advanced ADK planner configurations, A2A/MCP server setup via builder) will be crucial.</p>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "search.highlight"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>